(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{283:function(e,t,a){e.exports=a(378)},288:function(e,t,a){},363:function(e,t){},378:function(e,t,a){"use strict";a.r(t);var n={};a.r(n),a.d(n,"loginUserSuccess",(function(){return D})),a.d(n,"loginUserFailure",(function(){return L})),a.d(n,"loginUserRequest",(function(){return w})),a.d(n,"logout",(function(){return x})),a.d(n,"logoutAndRedirect",(function(){return I})),a.d(n,"redirectToRoute",(function(){return F})),a.d(n,"loginUser",(function(){return N})),a.d(n,"registerUserRequest",(function(){return G})),a.d(n,"registerUserSuccess",(function(){return M})),a.d(n,"registerUserFailure",(function(){return P})),a.d(n,"registerUser",(function(){return H}));var r={};a.r(r),a.d(r,"receiveProtectedData",(function(){return Ue})),a.d(r,"fetchProtectedDataRequest",(function(){return _e})),a.d(r,"fetchProtectedData",(function(){return ke})),a.d(r,"receiveUpdatedData",(function(){return Re})),a.d(r,"updateDataFailure",(function(){return Ae})),a.d(r,"updateUserDataRequest",(function(){return je})),a.d(r,"updateUserDataClose",(function(){return De})),a.d(r,"updateUserData",(function(){return Le})),a.d(r,"receiveUpdatedPhoto",(function(){return we})),a.d(r,"updateUserPhotoFailure",(function(){return xe})),a.d(r,"updateUserPhotoRequest",(function(){return Ie})),a.d(r,"updateUserPhoto",(function(){return Fe})),a.d(r,"fetchUsersDataRequest",(function(){return Ne})),a.d(r,"receiveUsersData",(function(){return Ge})),a.d(r,"cleanUsersData",(function(){return Me})),a.d(r,"fetchUsersData",(function(){return Pe})),a.d(r,"fetchUnauthorizedUserDataRequest",(function(){return He})),a.d(r,"fetchUnauthorizedUserDataFailure",(function(){return We})),a.d(r,"receiveUnauthorizedUsersData",(function(){return Be})),a.d(r,"cleanUnauthorizedUserData",(function(){return Qe})),a.d(r,"fetchUnauthorizedUserData",(function(){return ze})),a.d(r,"checkUserStatus",(function(){return Ve}));var s={};a.r(s),a.d(s,"receiveUserChats",(function(){return an})),a.d(s,"fetchUserChatsRequest",(function(){return nn})),a.d(s,"fetchUserChats",(function(){return rn})),a.d(s,"addChatRequest",(function(){return sn})),a.d(s,"addChatSuccess",(function(){return on})),a.d(s,"addChatFailure",(function(){return cn})),a.d(s,"addChatClose",(function(){return ln})),a.d(s,"addChat",(function(){return un})),a.d(s,"deleteChatRequest",(function(){return pn})),a.d(s,"deleteChatSuccess",(function(){return dn})),a.d(s,"deleteChatFailure",(function(){return hn})),a.d(s,"deleteChat",(function(){return gn})),a.d(s,"addGroupRequest",(function(){return mn})),a.d(s,"addGroupSuccess",(function(){return fn})),a.d(s,"addGroupFailure",(function(){return En})),a.d(s,"addGroup",(function(){return bn})),a.d(s,"updateGroupTitleRequest",(function(){return vn})),a.d(s,"updateGroupTitleSuccess",(function(){return Cn})),a.d(s,"updateGroupTitleFailure",(function(){return On})),a.d(s,"updateGroupTitle",(function(){return yn})),a.d(s,"updateGroupMembersRequest",(function(){return Tn})),a.d(s,"updateGroupMembersSuccess",(function(){return Sn})),a.d(s,"updateGroupMembersFailure",(function(){return Un})),a.d(s,"updateGroupMembers",(function(){return _n})),a.d(s,"deleteGroupRequest",(function(){return kn})),a.d(s,"deleteGroupSuccess",(function(){return Rn})),a.d(s,"deleteGroupFailure",(function(){return An})),a.d(s,"deleteGroup",(function(){return jn})),a.d(s,"readChatRequest",(function(){return Dn})),a.d(s,"readChatSuccess",(function(){return Ln})),a.d(s,"readChat",(function(){return wn})),a.d(s,"receiveUserGroups",(function(){return xn})),a.d(s,"fetchUserGroupsRequest",(function(){return In})),a.d(s,"fetchUserGroups",(function(){return Fn})),a.d(s,"receiveUpdatedPhoto",(function(){return Nn})),a.d(s,"updateGroupPhotoFailure",(function(){return Gn})),a.d(s,"updateGroupPhotoRequest",(function(){return Mn})),a.d(s,"updateGroupPhoto",(function(){return Pn})),a.d(s,"toggleSidebar",(function(){return Hn})),a.d(s,"handleToggleSidebar",(function(){return Wn}));var o=a(0),i=a.n(o),c=a(19),l=a.n(c),u=(a(288),a(207)),p=a(4),d=a(425),h=a(39),g=a(426),m=a(75),f=a(427),E=a(262),b=a.n(E),v=a(203),C=a(23);function O(e,t){return function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e,n=arguments.length>1?arguments[1]:void 0,r=t[n.type];return r?r(a,n.payload):a}}function y(e){return e.data}var T=a(24),S=a.n(T),U="".concat("","/api"),_=function(e){return{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}},k=function(e){return S.a.post("".concat(U,"/auth/is_token_valid"),{token:e},_(e))},R=function(e,t){return S.a.get("".concat(U,"/user/check_status/").concat(t),_(e))},A=a(42),j=Object(A.a)({});function D(e,t){return localStorage.setItem("token",e),localStorage.setItem("userLogin",t),{type:"LOGIN_USER_SUCCESS",payload:{token:e,login:t}}}function L(e){return localStorage.removeItem("token"),localStorage.removeItem("userLogin"),{type:"LOGIN_USER_FAILURE",payload:{status:e.response.status,statusText:e.response.statusText}}}function w(){return{type:"LOGIN_USER_REQUEST"}}function x(){return localStorage.removeItem("token"),localStorage.removeItem("userLogin"),{type:"LOGOUT_USER"}}function I(){return function(e){e(x()),j.push("/login")}}function F(e){return function(){j.push(e)}}function N(e,t){return function(a){return a({type:"LOGIN_USER_REQUEST"}),function(e,t){return S.a.post("".concat(U,"/auth/signin"),{login:e,password:t})}(e,t).then(y).then((function(t){try{a(D(t.token,e)),j.push("/")}catch(n){alert(n),a(L({response:{status:403,statusText:"Invalid token"}}))}})).catch((function(e){a(L({response:{status:403,statusText:"Invalid login or password"}}))}))}}function G(){return{type:"REGISTER_USER_REQUEST"}}function M(e,t){return localStorage.setItem("token",e),localStorage.setItem("userLogin",t),{type:"REGISTER_USER_SUCCESS",payload:{token:e,login:t}}}function P(e){return localStorage.removeItem("token"),{type:"REGISTER_USER_FAILURE",payload:{status:e.response.status,statusText:e.response.statusText}}}function H(e,t,a,n){return function(r){return r({type:"REGISTER_USER_REQUEST"}),function(e,t,a,n){return S.a.post("".concat(U,"/auth/signup"),{name:e,surname:t,login:a,password:n})}(e,t,a,n).then(y).then((function(e){try{r(M(e.token,a)),j.push("/")}catch(t){r(P({response:{status:403,statusText:"Invalid token"}}))}})).catch((function(e){r(P({response:{status:403,statusText:"User with that login already exists"}}))}))}}var W=a(121),B=a(22),Q=a(40),z=a.n(Q),V=a(91),Y=a(15),q=a(11),J=a(16),Z=a(17),K=a(10),$=a(18),X=function(e){return{drawer:Object(p.a)({width:480,flexShrink:0},e.breakpoints.down(1200),{width:280,marginLeft:"auto",marginRight:"auto"}),drawerPaper:Object(p.a)({width:480},e.breakpoints.down(1200),{width:280,marginLeft:"auto",marginRight:"auto"}),sidebarTop:{flexGrow:1,overflowY:"auto",paddingTop:0},sidebarDown:{padding:0},toolbar:e.mixins.toolbar,minifiedToolbar:{height:e.spacing(6)},button:{float:"right"},divider:{clear:"both"},addChatBtn:{height:"50px"},badge:{marginRight:"10px"}}},ee=a(409),te=a(412),ae=a(410),ne=a(379),re=a(413),se=a(402),oe=a(235),ie=a.n(oe),ce=a(128),le=a.n(ce),ue=a(236),pe=a.n(ue),de=a(400),he=a(431),ge=a(401),me=a(30),fe=a(8),Ee=a.n(fe),be=a(403),ve=a(171),Ce=a.n(ve);var Oe=function(e){function t(){var e,a;Object(Y.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(J.a)(this,(e=Object(Z.a)(t)).call.apply(e,[this].concat(r)))).checkTime=function(e){return e<10?"0"+e:e},a.userIsSender=function(){try{if(a.props.data)return a.props.data.login===a.props.lastMessage.sender.login}catch(e){return!1}return!1},a}return Object($.a)(t,e),Object(q.a)(t,[{key:"getTime",value:function(e){var t=e.getHours(),a=e.getMinutes();return t+":"+(a=this.checkTime(a))}},{key:"getWeekNumber",value:function(e){(e=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()))).setUTCDate(e.getUTCDate()+4-(e.getUTCDay()||7));var t=new Date(Date.UTC(e.getUTCFullYear(),0,1)),a=Math.ceil(((e-t)/864e5+1)/7);return[e.getUTCFullYear(),a]}},{key:"getTimeFormat",value:function(e){var t=new Date,a=new Date(e.getTime()).setHours(0,0,0,0)===new Date(t.getTime()).setHours(0,0,0,0),n=this.getWeekNumber(e)[0]===this.getWeekNumber(t)[0]&&this.getWeekNumber(e)[1]===this.getWeekNumber(t)[1],r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return a?this.getTime(e):n?["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][e.getDay()]:e.getUTCFullYear()===t.getUTCFullYear()?r[e.getMonth()]+" "+e.getDate():r[e.getMonth()]+" "+e.getDate()+", "+e.getUTCFullYear()}},{key:"render",value:function(){var e=this,t=this.props.users,a=this.props.classes,n="lg"===this.props.width?50:25;return this.props.data&&t?i.a.createElement(ne.a,{className:a.listItem,button:!0,selected:this.props.selected,onClick:this.props.onClick},"chat"===this.props.type?i.a.createElement(de.a,{className:a.listItemAvatar},i.a.createElement("div",{className:a.avatarContainer},t[0].profile_image?i.a.createElement(he.a,{src:""+t[0].profile_image}):i.a.createElement(he.a,{className:a.avatar},t[0].name.charAt(0).toUpperCase()+""+(t[0].surname?t[0].surname.charAt(0).toUpperCase():"")))):i.a.createElement(ge.a,{max:2},this.props.groupPhoto?i.a.createElement(he.a,{src:""+this.props.groupPhoto,className:a.groupWithPhoto}):t.slice(0,3).map((function(e,n){return i.a.createElement(he.a,{key:n,src:e.profile_image?""+e.profile_image:null,className:t.length<3?a.avatarGroup:a.avatarGroup3},e.profile_image?null:e.name.charAt(0).toUpperCase()+""+(e.surname?e.surname.charAt(0).toUpperCase():""))}))),i.a.createElement(se.a,{primary:"chat"===this.props.type?i.a.createElement("b",null,t[0].name+" "+(t[0].surname?t[0].surname:"")):i.a.createElement("b",null,this.props.chatTitle),secondary:i.a.createElement(i.a.Fragment,null,this.props.lastMessage.message.substr(0,n)+(this.props.lastMessage.message.length>n?"...":"")),className:t.length<3&&t.length>1?a.textGroup:a.textGroup3}),i.a.createElement("span",{className:a.time},this.props.lastMessage.timestamp?this.getTimeFormat(new Date(parseInt(this.props.lastMessage.timestamp))):null),"chat"===this.props.type&&!this.props.receiverHasRead&&!this.userIsSender()&&this.props.lastMessage.message.length>0?i.a.createElement(Ce.a,{color:"primary",className:a.notification}):null,"group"===this.props.type&&!this.userIsSender()&&this.props.receivers.find((function(t){return t.login===e.props.data.login}))?i.a.createElement(Ce.a,{color:"primary",className:a.notification}):null):null}}]),t}(i.a.Component),ye=Object(me.a)((function(e){return{isFetching:e.data.isFetching,token:e.auth.token,data:e.data.data}}),(function(e){return{getChats:function(t){return e(rn(t))},getGroups:function(t){return e(Fn(t))}}}))(Object(be.a)()(Ee()((function(e){return{listItem:{position:"relative","&.Mui-selected":{backgroundColor:"rgba(8, 116, 255, 0.2) !important"}},time:{fontSize:"12px",fontFamily:"'Roboto', sans-serif",position:"absolute",right:"16px",top:"14px",color:e.palette.text.secondary},avatarGroup:{marginLeft:"-35px","&:first-child":{marginLeft:"-5px"}},avatarGroup3:{marginLeft:"-35px","&:first-child":{marginLeft:"-8px"}},textGroup:{marginLeft:"8px"},textGroup3:{marginLeft:"6px"},notification:{position:"absolute",right:"19px",top:"30px"},groupWithPhoto:{marginLeft:-3},listItemAvatar:{minWidth:0}}}))(Oe))),Te=a(411),Se=a(408);function Ue(e){return{type:"RECEIVE_PROTECTED_DATA",payload:{data:e}}}function _e(){return{type:"FETCH_PROTECTED_DATA_REQUEST"}}function ke(e,t){return function(a){a({type:"FETCH_PROTECTED_DATA_REQUEST"}),function(e){return S.a.get("".concat(U,"/user"),_(e))}(e).then(y).then((function(e){a(Ue(e)),t&&t(e)})).catch((function(e){401===e.status&&a(I())}))}}function Re(e){return{type:"UPDATE_USER_DATA",payload:{data:e.data,status:{message:e.message,status:"OK"}}}}function Ae(e){return{type:"UPDATE_USER_DATA_FAILURE",payload:{status:{message:e.message,status:"ER"}}}}function je(){return{type:"UPDATE_USER_DATA_REQUEST"}}function De(){return{type:"UPDATE_USER_DATA_CLOSE",payload:{status:null}}}function Le(e,t){return function(a){a({type:"UPDATE_USER_DATA_REQUEST"}),function(e,t){return S.a.put("".concat(U,"/user"),t,_(e))}(e,t).then(y).then((function(t){a(Re(t)),a(ke(e))})).catch((function(e){403===e.response.status?a(I()):a(Ae(e.response.data))}))}}function we(e){return{type:"UPDATE_USER_PHOTO",payload:{data:e.data,status:{message:e.message,status:"OK"}}}}function xe(e){return{type:"UPDATE_USER_PHOTO_FAILURE",payload:{status:{message:e.message,status:"ER"}}}}function Ie(){return{type:"UPDATE_USER_PHOTO_REQUEST"}}function Fe(e,t){return function(a){a({type:"UPDATE_USER_PHOTO_REQUEST"}),function(e,t){return S.a.put("".concat(U,"/user/image"),t,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(e)}})}(e,t).then(y).then((function(e){a(we(e))})).catch((function(e){403===e.response.status?a(I()):a(xe(e.response.data))}))}}function Ne(){return{type:"FETCH_USERS_DATA_REQUEST"}}function Ge(e){return{type:"RECEIVE_USERS_DATA",payload:{users:e}}}function Me(){return{type:"CLEAN_USERS_DATA"}}function Pe(e,t){return function(a){a({type:"FETCH_USERS_DATA_REQUEST"}),function(e,t){return S.a.get("".concat(U,"/users/").concat(t),_(e))}(e,t).then(y).then((function(e){a(Ge(e))})).catch((function(e){a(I())}))}}function He(){return{type:"FETCH_UNAUTHORIZED_USER_DATA"}}function We(e){return{type:"FETCH_UNAUTHORIZED_USER_DATA_FAILURE",payload:{status:{message:e.message,status:"ER"}}}}function Be(e){return{type:"RECEIVE_UNAUTHORIZED_USER_DATA",payload:{unauthorizedUser:e}}}function Qe(){return{type:"CLEAN_UNAUTHORIZED_USER_DATA"}}function ze(e){return function(t){t({type:"FETCH_UNAUTHORIZED_USER_DATA"}),function(e){return S.a.get("".concat(U,"/user/").concat(e),{headers:{"Content-Type":"application/json"}})}(e).then(y).then((function(e){t(Be(e))})).catch((function(e){t(We(e.response.data))}))}}function Ve(e,t){return Ye.apply(this,arguments)}function Ye(){return(Ye=Object(V.a)(z.a.mark((function e(t,a){var n;return z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=localStorage.getItem("token"),R(n,t).then(y).then((function(e){a(e.online)}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var qe=!1,Je=Ee()((function(e){return{badge:{backgroundColor:"#44b700",color:"#44b700",boxShadow:"0 0 0 2px ".concat(e.palette.background.paper),"&::after":{position:"absolute",top:-1,left:-1,width:"100%",height:"100%",borderRadius:"50%",animation:"$ripple 1.2s infinite ease-in-out",border:"1px solid currentColor",content:'""'}},"@keyframes ripple":{"0%":{transform:"scale(.8)",opacity:1},"100%":{transform:"scale(2.4)",opacity:0}}}}))(Se.a),Ze=function(e){function t(e){var a;return Object(Y.a)(this,t),(a=Object(J.a)(this,Object(Z.a)(t).call(this,e))).setStatus=function(e){a.setState({online:e})},a.checkTime=function(e){return e<10?"0"+e:e},a.getTimeFormat=function(e){var t=new Date(parseInt(e)),n=new Date,r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return new Date(t.getTime()).setHours(0,0,0,0)===new Date(n.getTime()).setHours(0,0,0,0)?a.getTime(t):t.getUTCFullYear()===n.getUTCFullYear()?r[t.getMonth()]+" "+t.getDate()+", "+a.getTime(t):r[t.getMonth()]+" "+t.getDate()+", "+t.getUTCFullYear()},a.state={online:!1},a}return Object($.a)(t,e),Object(q.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.user&&Ve(this.props.user.login,this.setStatus),Xa.on("user_status_changed",(function(t){e.props.user&&t.user===e.props.user.login&&(Ve(e.props.user.login,e.setStatus),e.props.getChats(e.props.token),e.props.getGroups(e.props.token))}))}},{key:"componentWillUnmount",value:function(){Xa.removeAllListeners("user_status_changed")}},{key:"getTime",value:function(e){var t=e.getHours(),a=e.getMinutes();return t+":"+(a=this.checkTime(a))}},{key:"render",value:function(){var e=this,t=this.props.classes,a=this.props.user;return a?(qe||this.props.currentUser!==a.login||(Ve(a.login,this.setStatus),qe=!0),i.a.createElement(ne.a,{className:this.props.handleClick?t.pointedListItem:t.listItem,onClick:this.props.handleClick?function(){return e.props.handleClick(a.login)}:null,button:!!this.props.handleClick,selected:this.props.selected},i.a.createElement(de.a,null,this.state.online?i.a.createElement("div",{className:t.avatarContainer},i.a.createElement(Je,{overlap:"circle",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot"},a.profile_image?i.a.createElement(he.a,{src:""+a.profile_image,className:t.avatar}):i.a.createElement(he.a,{className:t.avatar},a.name.charAt(0).toUpperCase()+""+(a.surname?a.surname.charAt(0).toUpperCase():"")))):i.a.createElement("div",{className:t.avatarContainer},a.profile_image?i.a.createElement(he.a,{src:""+a.profile_image,className:t.avatar}):i.a.createElement(he.a,{className:t.avatar},a.name.charAt(0).toUpperCase()+""+(a.surname?a.surname.charAt(0).toUpperCase():"")))),i.a.createElement(se.a,{primary:i.a.createElement("b",null,a.name+" "+(a.surname?a.surname:"")),secondary:i.a.createElement(i.a.Fragment,null,this.state.online?a.login:"Last seen: "+this.getTimeFormat(a.last_seen))}),this.props.groupOwner&&this.props.groupOwner===a.login?i.a.createElement(Se.a,{color:"primary",badgeContent:"Owner",className:t.owner}):null)):null}}]),t}(i.a.Component),Ke=Object(me.a)((function(e){return{token:e.auth.token,currentUser:e.auth.login}}),(function(e){return{getChats:function(t){return e(rn(t))},getGroups:function(t){return e(Fn(t))}}}))(Ee()((function(e){return{listItem:{position:"relative","&.Mui-selected":{backgroundColor:"rgba(8, 116, 255, 0.2) !important"}},pointedListItem:{position:"relative",cursor:"pointer","&.Mui-selected":{backgroundColor:"rgba(8, 116, 255, 0.2) !important"}},time:{fontSize:"12px",fontFamily:"'Roboto', sans-serif",position:"absolute",right:"16px",top:"14px",color:e.palette.text.secondary},avatar:{borderColor:e.palette.text.disabled},owner:{"& span":{position:"relative",transform:"none"}},avatarContainer:{display:"flex","& > *":{margin:e.spacing(1)}}}}))(Ze)),$e=a(129),Xe=a.n($e),et=a(234),tt=a.n(et);var at=function(e){function t(){return Object(Y.a)(this,t),Object(J.a)(this,Object(Z.a)(t).apply(this,arguments))}return Object($.a)(t,e),Object(q.a)(t,[{key:"render",value:function(){var e=this,t=this.props.classes;return i.a.createElement(ee.a,{anchor:"left",open:this.props.sidebarOpen,onClose:function(){return e.props.handleToggleSidebar(!1)},className:"sidebar "+t.drawer,variant:"xs"===this.props.width?"temporary":"permanent",classes:{paper:t.drawerPaper}},i.a.createElement("div",{className:"lg"===this.props.width?t.toolbar:t.minifiedToolbar},i.a.createElement(v.a,{onClick:function(){return e.props.handleToggleSidebar(!1)},className:t.button},i.a.createElement(tt.a,null)),i.a.createElement(ae.a,{className:t.divider})),i.a.createElement(Te.a,{fullWidth:!0,color:"primary",className:t.addChatBtn,onClick:this.props.newChatBtnHandle},"Add New Chat"),i.a.createElement(te.a,{className:t.sidebarTop},this.props.chatList?this.props.chatList.sort((function(e,t){return parseFloat(t.lastUpdate)-parseFloat(e.lastUpdate)})).map((function(t,a){return i.a.createElement(ye,{key:a,type:t.type,chatTitle:t.title,lastMessage:t.messages.length>0?t.messages[t.messages.length-1]:{message:""},users:t.users.filter((function(t){return t.login!==e.props.userLogin})),selected:e.props.selectedChatIndex===t.chat_id,onClick:function(){e.props.handleToggleSidebar(!1),e.props.selectChatHandle(t.chat_id,e.props.chatList)},receiverHasRead:t.receiverHasRead,receivers:t.receivers,groupPhoto:"group"===t.type?t.photo:null})})):null),i.a.createElement("div",{className:"sidebar-down"},i.a.createElement(ae.a,null),i.a.createElement(Ke,{user:this.props.user,currentUser:this.props.userLogin}),i.a.createElement(te.a,{className:t.sidebarDown},i.a.createElement(ne.a,{button:!0,onClick:this.props.accountHandleClick},i.a.createElement(re.a,null,i.a.createElement(ie.a,null)),i.a.createElement(se.a,{primary:"My Account"})),i.a.createElement(ne.a,{button:!0,onClick:this.props.contactsHandleClick},i.a.createElement(re.a,null,i.a.createElement(le.a,null)),i.a.createElement(se.a,{primary:"Contacts"}),this.props.invitations&&this.props.invitations.received.length>0?i.a.createElement(Se.a,{badgeContent:this.props.invitations.received.length,color:"primary",className:t.badge}):null),i.a.createElement(ne.a,{button:!0,onClick:this.props.logOutHandleClick},i.a.createElement(re.a,null,i.a.createElement(pe.a,null)),i.a.createElement(se.a,{primary:"Log Out"})))))}}]),t}(i.a.Component),nt=Object(me.a)((function(e){return{isFetching:e.chats.isFetching,loaded:e.chats.loaded,chats:e.chats.chats,userLogin:e.auth.login,invitations:e.contacts.invitations,sidebarOpen:e.chats.sidebarOpen}}),(function(e){return Object(C.b)(s,e)}))(Xe()()(Ee()(X)(at))),rt=function(e){return{content:{height:"calc(100vh - 144px)",padding:"25px",boxSizing:"border-box",overflowY:"scroll",width:"100%"},userSent:{float:"right",clear:"both",padding:"10px 20px 18px",boxSizing:"border-box",wordWrap:"break-word",marginTop:"10px",backgroundColor:e.palette.primary.main,color:"white",width:"auto",maxWidth:"500px",borderRadius:"10px",borderBottomRightRadius:0,fontFamily:"Roboto",position:"relative"},friendSent:{float:"left",clear:"both",padding:"10px 20px 18px",boxSizing:"border-box",wordWrap:"break-word",marginTop:"10px",backgroundColor:"white",color:e.palette.text.primary,width:"auto",maxWidth:"500px",borderRadius:"10px",borderTopLeftRadius:0,fontFamily:"Roboto",position:"relative"},time:{position:"absolute",bottom:"5px",right:"5px",fontSize:"10px"},messageContainer:{clear:"both",paddingTop:"35px"},divider:{width:"60%",position:"relative",background:"linear-gradient(90deg, rgba(220,220,220,1) 0%, rgba(173,173,173,1) 50%, rgba(220,220,220,1) 100%)",margin:"0 auto 35px",height:"1px"},dividerDate:{margin:0,position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"#dcdcdc",padding:"0 20px",fontFamily:"'Roboto', sans-serif",fontSize:"12px",color:"#7d7d7d"},avatar:{marginRight:"10px"},noAvatar:{marginLeft:"50px"},messageGroupUser:{display:"flex",width:"100%",alignItems:"center",justifyContent:"flex-end"},messageGroupFriend:{display:"flex",width:"100%",alignItems:"center",justifyContent:"flex-start"},btnContainer:{paddingLeft:30,position:"relative","&:hover button":{display:"block"}},moreBtn:{padding:0,position:"absolute",left:0,top:"50%",transform:"translateY(-36%)",display:"none","&:hover":{backgroundColor:"transparent !important"}},menu:{"& ul":{padding:0}},loader:{width:"16px !important",height:"16px !important",position:"absolute",left:0,top:"calc(50% - 2px)"}}},st=a(130),ot=a.n(st),it=a(266),ct=a(415),lt=a(414);function ut(e){var t=new Date,a=["January","February","March","April","May","June","July","August","September","October","November","December"];return new Date(e.getTime()).setHours(0,0,0,0)===new Date(t.getTime()).setHours(0,0,0,0)?"Today":e.getUTCFullYear()===t.getUTCFullYear()?a[e.getMonth()]+" "+e.getDate():a[e.getMonth()]+" "+e.getDate()+", "+e.getUTCFullYear()}var pt=function(e){function t(e){var a;return Object(Y.a)(this,t),(a=Object(J.a)(this,Object(Z.a)(t).call(this,e))).handleOpenMessageMenu=function(e,t){a.setState({anchorMenu:e.currentTarget,removeTarget:t.id})},a.handleCloseMessageMenu=function(){a.setState({anchorMenu:null,removeTarget:null})},a.state={anchorMenu:null,removeTarget:null},a}return Object($.a)(t,e),Object(q.a)(t,[{key:"componentDidMount",value:function(){var e=document.getElementById("chatview-container");e&&e.scrollTo(0,e.scrollHeight),this.handleCloseMessageMenu()}},{key:"componentDidUpdate",value:function(){var e=document.getElementById("chatview-container");e&&e.scrollTo(0,e.scrollHeight)}},{key:"getTime",value:function(e){var t,a=e.getHours(),n=e.getMinutes();return a+":"+(n=(t=n)<10?"0"+t:t)}},{key:"setDivider",value:function(e,t){if(0!==t){var a=null;return new Date(parseInt(e.timestamp)).setHours(0,0,0,0)!==new Date(parseInt(this.props.chat.messages[t-1].timestamp)).setHours(0,0,0,0)&&(a=ut(new Date(parseInt(e.timestamp)))),a}return ut(new Date(parseInt(e.timestamp)))}},{key:"setAvatar",value:function(e,t){return!(t+1<this.props.chat.messages.length)||e.sender.login!==this.props.chat.messages[t+1].sender.login}},{key:"render",value:function(){var e=this,t=this.props.classes,a=Object(B.a)(this.props.messages);return i.a.createElement("div",{id:"chatview-container",className:t.content},i.a.createElement("main",null,a.filter((function(e){return null!==e})).map((function(a,n){return i.a.createElement("div",{className:e.setDivider(a,n)?t.messageContainer:null,key:n},e.setDivider(a,n)?i.a.createElement("div",{className:t.divider},i.a.createElement(m.a,{component:"p",variant:"body1",className:t.dividerDate},e.setDivider(a,n))):null,i.a.createElement("div",{className:a.sender.login===e.props.userLogin?t.messageGroupUser:t.messageGroupFriend},e.setAvatar(a,n)&&a.sender.login!==e.props.userLogin?i.a.createElement("div",{className:t.avatar},a.sender.profile_image?i.a.createElement(he.a,{src:""+a.sender.profile_image}):i.a.createElement(he.a,null,a.sender.name.charAt(0).toUpperCase()+""+(a.sender.surname?a.sender.surname.charAt(0).toUpperCase():""))):i.a.createElement("span",{className:t.noAvatar}),i.a.createElement("div",{className:a.sender.login===e.props.userLogin?t.btnContainer:null},a.sender.login!==e.props.userLogin||a.loading?null:i.a.createElement(v.a,{className:t.moreBtn,onClick:function(t){return e.handleOpenMessageMenu(t,a)}},i.a.createElement(ot.a,null)),a.loading?i.a.createElement(lt.a,{className:t.loader}):null,i.a.createElement("div",{key:n,className:a.sender.login===e.props.userLogin?t.userSent:t.friendSent},a.message,i.a.createElement("span",{className:t.time},e.getTime(new Date(parseInt(a.timestamp))))))))})),i.a.createElement(it.a,{open:Boolean(this.state.anchorMenu),anchorEl:this.state.anchorMenu,onClose:this.handleCloseMessageMenu,className:t.menu},i.a.createElement(ct.a,{onClick:function(){e.props.handleRemoveMessage(e.state.removeTarget),e.handleCloseMessageMenu()}},"Remove"))))}}]),t}(i.a.Component),dt=Object(me.a)((function(e){return{userLogin:e.auth.login}}),(function(e){return Object(C.b)(s,e)}))(Ee()(rt)(pt)),ht=function(e){var t,a;return{dashboard:{height:"100%",display:"flex"},content:(t={marginTop:64},Object(p.a)(t,e.breakpoints.down("md"),{marginTop:48,marginRight:0}),Object(p.a)(t,"flexGrow",1),Object(p.a)(t,"maxHeight","100%"),Object(p.a)(t,"marginRight",-350),Object(p.a)(t,"transition",e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})),t),contentShift:(a={marginTop:64},Object(p.a)(a,e.breakpoints.down("md"),{marginTop:48}),Object(p.a)(a,"flexGrow",1),Object(p.a)(a,"maxHeight","100%"),Object(p.a)(a,"marginRight",0),Object(p.a)(a,"transition",e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})),a),bigIcon:{fontSize:"10em",fill:"#9a9a9a"},defaultComponent:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",textAlign:"center",flexGrow:2,transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},text:{color:"#737373"},chatViewContainer:{height:"100%",overflow:"hidden",display:"flex",flexDirection:"column"}}},gt=a(261),mt=a.n(gt),ft=a(416),Et=a(239),bt=a.n(Et),vt=function(e){return{messageBox:{flexGrow:1,backgroundColor:"white",display:"flex",alignItems:"center",minHeight:"80px",padding:"0 30px",width:"calc(100% - 60px)",zIndex:999},textField:{"&:hover:before":{borderBottom:"1px solid rgba(0, 0, 0, 0.42) !important"},width:"95%"},button:{color:"#0874ff",cursor:"pointer",marginLeft:"15px"}}},Ct=function(e){function t(e){var a;return Object(Y.a)(this,t),(a=Object(J.a)(this,Object(Z.a)(t).call(this,e))).messageValid=function(e){return e&&e.replace(/\s/g,"").length>0},a.state={message:""},a.submitMessage=a.submitMessage.bind(Object(K.a)(a)),a}return Object($.a)(t,e),Object(q.a)(t,[{key:"render",value:function(){var e=this,t=this.props.classes;return i.a.createElement("div",{className:"message-box "+t.messageBox},i.a.createElement(ft.a,{style:{margin:8},placeholder:"Enter your message...",margin:"normal",className:t.textField,onKeyUp:function(t){return e.userTyping(t)},onChange:function(t){return e.setState({message:t.target.value})},autoComplete:"off",id:"message-box",helperText:"Press Enter to send the message",value:this.state.message}),i.a.createElement(bt.a,{onClick:this.submitMessage,className:t.button}))}},{key:"userTyping",value:function(e){13===e.keyCode?this.submitMessage():this.setState({message:e.target.value})}},{key:"submitMessage",value:function(){this.messageValid(this.state.message)&&(this.props.sendMessageHandle(this.state.message,this.props.selectedChatType),this.setState({message:""}))}}]),t}(i.a.Component),Ot=Ee()(vt)(Ct),yt=a(417),Tt=a(421),St=a(419),Ut=a(420),_t=a(418);var kt=Object(h.b)((function(e){return{isAuthenticating:e.auth.isAuthenticating,statusText:e.auth.statusText}}),(function(e){return Object(C.b)(n,e)}))((function(e){var t=function(){e.setOpen("logout",!1)};return i.a.createElement(yt.a,{open:e.open,onClose:t,"aria-labelledby":"logout-dialog-title","aria-describedby":"logout-dialog-description"},i.a.createElement(_t.a,{id:"logout-dialog-title"},"Log Out"),i.a.createElement(St.a,null,i.a.createElement(Ut.a,{id:"logout-dialog-description"},"Are you sure you want to log out?")),i.a.createElement(Tt.a,null,i.a.createElement(Te.a,{onClick:e.logout,color:"primary"},"Ok"),i.a.createElement(Te.a,{onClick:t,color:"primary",autoFocus:!0},"Cancel")))})),Rt=a(56),At=a.n(Rt),jt=a(44),Dt=a.n(jt),Lt=a(430),wt=a(240),xt=a.n(wt),It=(a(329),a(265));var Ft=function(e){function t(e){var a;return Object(Y.a)(this,t),(a=Object(J.a)(this,Object(Z.a)(t).call(this,e))).onSelectFile=function(e){if(e&&e.length>0){var t=new FileReader;t.addEventListener("load",(function(){return a.setState({src:t.result})})),t.readAsDataURL(e[0])}},a.onImageLoaded=function(e){return a.imageRef=e},a.onCropChange=function(e){return a.setState({crop:e})},a.handleClose=function(){a.setState({src:null}),a.props.setOpen(!1)},a.state={src:null,crop:{unit:"%",width:100,aspect:1},error:""},a.handleSave=a.handleSave.bind(Object(K.a)(a)),a.onSelectFile=a.onSelectFile.bind(Object(K.a)(a)),a}return Object($.a)(t,e),Object(q.a)(t,[{key:"getCroppedImg",value:function(e,t){var a=document.createElement("canvas"),n=e.naturalWidth/e.width,r=e.naturalHeight/e.height;return a.width=t.width,a.height=t.height,a.getContext("2d").drawImage(e,t.x*n,t.y*r,t.width*n,t.height*r,0,0,t.width,t.height),new Promise((function(e,t){a.toBlob((function(t){if(t){var a=new FormData;a.append("file",t,"profile_photo.jpg"),e(a)}else console.error("Canvas is empty")}),"image/jpeg")}))}},{key:"handleSave",value:function(){var e=Object(V.a)(z.a.mark((function e(){var t=this;return z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.imageRef){e.next=5;break}return e.next=3,this.getCroppedImg(this.imageRef,this.state.crop).then((function(e){t.props.handleUpdatePhoto(e),t.handleClose()}));case 3:e.next=6;break;case 5:this.setState({error:"Please choose the file."});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.props.classes,t=this.state,a=t.crop,n=t.croppedImageUrl,r=t.src;return i.a.createElement(yt.a,{open:this.props.open,onClose:this.handleClose,"aria-labelledby":"add-chat-dialog-title","aria-describedby":"add-chat-dialog-description",maxWidth:"xs",fullWidth:!0},i.a.createElement(_t.a,{id:"add-chat-dialog-title"},"Choose New Photo"),i.a.createElement(St.a,null,this.props.error||this.state.error?i.a.createElement(Lt.a,{severity:"error"},this.props.error?this.props.error:this.state.error):null,this.state.src?null:i.a.createElement(It.a,{onChange:this.onSelectFile,acceptedFiles:["image/*"],filesLimit:1,showPreviewsInDropzone:!1,dropzoneClass:e.drop}),r&&i.a.createElement(xt.a,{src:r,crop:a,ruleOfThirds:!0,onImageLoaded:this.onImageLoaded,onChange:this.onCropChange}),n&&i.a.createElement("img",{alt:"Crop",style:{maxWidth:"100%"},src:n})),i.a.createElement(Tt.a,null,i.a.createElement(Te.a,{onClick:this.handleSave,color:"primary"},"Save"),i.a.createElement(Te.a,{onClick:this.handleClose,color:"primary",autoFocus:!0},"Cancel")))}}]),t}(i.a.Component),Nt=Object(me.a)((function(e){return{token:e.auth.token}}),(function(e){return Object(C.b)(r,e)}))(Ee()((function(e){return{drop:{display:"flex",justifyContent:"center",alignItems:"center","& p":{fontFamily:"Roboto, sans-serif",fontSize:"16px",color:e.palette.text.primary,marginBottom:0}}}}))(Ft)),Gt=a(423);var Mt=function(e){function t(e){var a;return Object(Y.a)(this,t),(a=Object(J.a)(this,Object(Z.a)(t).call(this,e))).loginIsValid=function(){return a.state.login.length>=6},a.passwordIsValid=function(){return a.state.password.length>=6},a.formIsValid=function(){return a.state.password===a.state.passwordConfirmation},a.handleClose=function(){a.props.setOpen("account",!1),a.props.updateUserDataClose(),a.setState({updateError:""})},a.handleSave=function(){var e={};if(a.state.password.length>0){if(!a.passwordIsValid())return void a.setState({updateError:"Password must be at least 6 characters.",password:"",passwordConfirmation:""});if(!a.formIsValid())return void a.setState({updateError:"Passwords do not match",password:"",passwordConfirmation:""});if(!a.loginIsValid())return void a.setState({updateError:"Login must be at least 6 characters."});e={name:a.state.name,surname:a.state.surname,login:a.state.login,password:a.state.password}}else e={name:a.state.name,surname:a.state.surname,login:a.state.login};a.setState({updateError:""}),a.props.updateUserData(a.props.token,e)},a.handleDialogOpen=function(e){return a.setState({editPhotoDialogOpen:e})},a.handleUpdatePhoto=function(e){a.props.updateUserPhoto(a.props.token,e)},a.userTyping=function(e,t){switch(e){case"name":a.setState({name:t.target.value});break;case"surname":a.setState({surname:t.target.value});break;case"login":a.setState({login:t.target.value});break;case"password":a.setState({password:t.target.value});break;case"passwordConfirmation":a.setState({passwordConfirmation:t.target.value})}},a.state={name:"",surname:"",login:"",password:"",passwordConfirmation:"",updateError:"",editPhotoDialogOpen:!1,img:""},a.handleSave=a.handleSave.bind(Object(K.a)(a)),a.initData=a.initData.bind(Object(K.a)(a)),a}return Object($.a)(t,e),Object(q.a)(t,[{key:"initData",value:function(e){this.setState({name:e.name,surname:e.surname,login:e.login})}},{key:"componentDidMount",value:function(){this.props.fetchProtectedData(this.props.token,this.initData)}},{key:"render",value:function(){var e=this,t=this.props.classes;return i.a.createElement(yt.a,{open:this.props.open,onClose:this.handleClose,"aria-labelledby":"account-dialog-title","aria-describedby":"account-dialog-description",maxWidth:"sm",fullWidth:!0},i.a.createElement(_t.a,{id:"account-dialog-title"},"My Account"),i.a.createElement(St.a,null,!this.props.status||this.state.updateError.length>0?null:i.a.createElement(Dt.a,{severity:"OK"===this.props.status.status?"success":"error",className:t.alert},this.props.status.message),this.state.updateError?i.a.createElement(Dt.a,{severity:"error",className:t.alert},this.state.updateError):null,i.a.createElement("center",null,i.a.createElement(Gt.a,{title:"Click to add new profile photo"},this.props.data.profile_image?i.a.createElement(At.a,{className:t.avatar,src:""+this.props.data.profile_image,onClick:function(){return e.handleDialogOpen(!0)}}):i.a.createElement(At.a,{className:t.avatar,onClick:function(){return e.handleDialogOpen(!0)}},(this.state.name?this.state.name.charAt(0).toUpperCase():"")+""+(this.state.surname?this.state.surname.charAt(0).toUpperCase():"")))),i.a.createElement(ft.a,{margin:"dense",id:"account-name-input",label:"Name",fullWidth:!0,value:this.state.name,onChange:function(t){return e.userTyping("name",t)},autoComplete:"off"}),i.a.createElement(ft.a,{margin:"dense",id:"account-surname-input",label:"Surname",fullWidth:!0,value:this.state.surname,onChange:function(t){return e.userTyping("surname",t)},autoComplete:"off"}),i.a.createElement(ft.a,{margin:"dense",id:"account-login-input",label:"Login",fullWidth:!0,value:this.state.login,onChange:function(t){return e.userTyping("login",t)},autoComplete:"off",disabled:!0}),i.a.createElement(m.a,{component:"h6",variant:"h6",className:t.label},"Change Password:"),i.a.createElement(ft.a,{margin:"dense",id:"account-password-input",label:"New Password",fullWidth:!0,value:this.state.password,onChange:function(t){return e.userTyping("password",t)},type:"password",className:t.passwordInput}),i.a.createElement(ft.a,{margin:"dense",id:"account-password-confirmation-input",label:"Confirm Password",fullWidth:!0,value:this.state.passwordConfirmation,onChange:function(t){return e.userTyping("passwordConfirmation",t)},type:"password"})),i.a.createElement(Tt.a,null,i.a.createElement(Te.a,{onClick:this.handleSave,color:"primary"},"Save"),i.a.createElement(Te.a,{onClick:this.handleClose,color:"primary",autoFocus:!0},"Close")),i.a.createElement(Nt,{open:this.state.editPhotoDialogOpen,setOpen:this.handleDialogOpen,handleUpdatePhoto:this.handleUpdatePhoto}))}}]),t}(i.a.Component),Pt=Object(h.b)((function(e){return{isFetching:e.data.isFetching,data:e.data.data,status:e.data.status,token:e.auth.token}}),(function(e){return Object(C.b)(r,e)}))(Ee()((function(e){return{avatar:{width:150,height:150,fontSize:"2.25rem",border:"2px solid",borderColor:e.palette.primary.main,cursor:"pointer",position:"relative"},form:{width:"100%"},input:{"&:hover:before":{borderBottom:"1px solid rgba(0, 0, 0, 0.42) !important"}},label:{fontSize:"16px",marginTop:"10px"},passwordInput:{marginTop:"-5px"},alert:{marginBottom:"20px"}}}))(Mt)),Ht=a(251),Wt=a.n(Ht),Bt=a(429),Qt=a(424);function zt(e){return function(t){t({type:"FETCH_CONTACT_LIST_REQUEST"}),function(e){return S.a.get("".concat(U,"/contacts"),_(e))}(e).then(y).then((function(e){t({type:"RECEIVE_CONTACT_LIST",payload:{data:e}})})).catch((function(e){}))}}function Vt(e,t){return function(a){a({type:"FETCH_FILTERED_CONTACT_LIST_REQUEST"}),function(e,t){return S.a.get("".concat(U,"/contacts/").concat(t),_(e))}(e,t).then(y).then((function(e){a({type:"RECEIVE_FILTERED_CONTACT_LIST",payload:{data:e}})})).catch((function(e){}))}}function Yt(e){return function(t){t({type:"FETCH_INVITATION_LIST_REQUEST"}),function(e){return S.a.get("".concat(U,"/invitations"),_(e))}(e).then(y).then((function(e){t({type:"RECEIVE_INVITATION_LIST",payload:{data:e}})})).catch((function(e){}))}}var qt=a(55),Jt=a.n(qt),Zt=a(52),Kt=a.n(Zt),$t=a(53),Xt=a.n($t),ea=a(68),ta=a.n(ea);var aa=Ee()((function(e){return{progress:{display:"flex",justifyContent:"center",alignItems:"center",marginTop:"15px"},user:{cursor:"pointer"},error:{marginTop:"15px"}}}))((function(e){var t=e.value,a=e.index,n=e.classes;return i.a.createElement("div",{hidden:t!==a,id:"simple-tabpanel-".concat(a),"aria-labelledby":"simple-tab-".concat(a)},t===a&&i.a.createElement("div",null,e.error?i.a.createElement(Dt.a,{severity:"error",className:n.error},e.error):null,i.a.createElement("div",null,i.a.createElement(Jt.a,{margin:"dense",id:"add-chat-login-input",label:"Enter user login",fullWidth:!0,value:e.login,onChange:function(t){return e.userTyping(t,"add-chat-login")},autoComplete:"off"}),e.usersList&&e.login.length>=3?i.a.createElement("div",{className:"users-list"},e.usersList.map((function(t,a){return i.a.createElement(Ke,{key:a,user:t,className:n.user,handleClick:e.chooseUser,selected:e.login===t.login})}))):null,e.usersList&&0===e.usersList.length&&e.login.length>=3?i.a.createElement(Kt.a,null,i.a.createElement(Xt.a,{secondary:"User with this login does not exist or you already have a chat with this user."})):null,e.isFetching?i.a.createElement("div",{className:n.progress},i.a.createElement(ta.a,{color:"primary"})):null)))})),na=a(432),ra=a(80),sa=a.n(ra);var oa=Ee()((function(e){return{progress:{display:"flex",justifyContent:"center",alignItems:"center",marginTop:"15px"},user:{cursor:"pointer"},list:{maxHeight:"216px",overflowY:"auto"},label:{fontSize:"16px",marginTop:"10px"},chip:{marginRight:"3px"},error:{marginTop:15}}}))((function(e){var t=e.value,a=e.index,n=e.classes;return i.a.createElement("div",{hidden:t!==a,id:"simple-tabpanel-".concat(a),"aria-labelledby":"simple-tab-".concat(a)},t===a&&i.a.createElement("div",null,e.error?i.a.createElement(Dt.a,{severity:"error",className:n.error},e.error):null,e.validation?i.a.createElement(Dt.a,{severity:"error",className:n.error},e.validation):null,i.a.createElement("div",null,i.a.createElement(Jt.a,{margin:"dense",id:"add-group-title-input",label:"Title",fullWidth:!0,value:e.chatTitle,onChange:function(t){return e.userTyping(t,"title")},autoComplete:"off"}),e.groupUserList.length>0?i.a.createElement("div",null,i.a.createElement(sa.a,{className:n.label,component:"h6",variant:"h6"},"User list:"),e.groupUserList.map((function(t,a){return i.a.createElement(na.a,{key:a,className:n.chip,avatar:t.profile_image?i.a.createElement(he.a,{src:""+t.profile_image}):i.a.createElement(he.a,null,(t.name?t.name.charAt(0).toUpperCase():"")+""+(t.surname?t.surname.charAt(0).toUpperCase():"")),label:t.name+" "+t.surname,variant:"outlined",onDelete:function(){return e.removeUserFromList(t.login)}})}))):null,i.a.createElement(Jt.a,{margin:"dense",id:"add-group-login-input",label:"Filter by user name",fullWidth:!0,value:e.login,onChange:function(t){return e.userTyping(t,"add-group-login")},autoComplete:"off"}),e.contactList?i.a.createElement("div",{className:n.list},e.contactList.sort((function(e,t){return e.name<t.name?-1:1})).filter((function(t){return(t.name+" "+t.surname).toLowerCase().includes(e.login.toLowerCase())})).filter((function(t){return!e.userInList(t)})).map((function(t,a){return i.a.createElement(Ke,{key:a,user:t,className:n.user,handleClick:function(){return e.addUserToList(t)},selected:!1})}))):null,e.contactList&&0===e.contactList.length?i.a.createElement(Kt.a,null,i.a.createElement(Xt.a,{secondary:"User with this login does not exist or you already have a chat with this user."})):null,e.isFetching?i.a.createElement("div",{className:n.progress},i.a.createElement(ta.a,{color:"primary"})):null)))}));var ia=function(e){function t(e){var a;return Object(Y.a)(this,t),(a=Object(J.a)(this,Object(Z.a)(t).call(this,e))).userTyping=function(e,t){switch(t){case"add-chat-login":var n=e.target.value;n.length>=3?a.props.fetchFilteredContactList(a.props.token,n):a.props.cleanContactList(),a.setState({addChatLogin:n});break;case"add-group-login":a.setState({addGroupLogin:e.target.value});break;case"title":var r=e.target.value;a.setState({chatTitle:r})}},a.handleClose=function(){a.props.setOpen("add-chat",!1),a.setState({addChatLogin:"",addGroupLogin:"",chatTitle:"",groupUserList:[],currentTab:0}),a.props.addChatClose(),a.props.cleanUsersData()},a.handleAddChat=function(){if(0===a.state.currentTab)a.props.addChat(a.state.addChatLogin,a.props.setOpen);else{for(var e=[],t=a.state.chatTitle,n=0;n<a.state.groupUserList.length;n++)e.push(a.state.groupUserList[n].login);t.length<3?a.setState({addGroupError:"Title should have minimum 3 symbols."}):e.length<2?a.setState({addGroupError:"Please choose minimum 2 users."}):(a.props.addGroup(t,e,a.props.setOpen),a.setState({addGroupError:null}))}a.setState({addChatLogin:"",addGroupLogin:"",chatTitle:"",groupUserList:[]})},a.handleChange=function(e,t){a.setState({currentTab:t})},a.state={addChatLogin:"",addGroupLogin:"",chatTitle:"",groupUserList:[],currentTab:0,addGroupError:null},a.userTyping=a.userTyping.bind(Object(K.a)(a)),a.chooseUser=a.chooseUser.bind(Object(K.a)(a)),a.handleAddUserToList=a.handleAddUserToList.bind(Object(K.a)(a)),a.handleRemoveUserFromList=a.handleRemoveUserFromList.bind(Object(K.a)(a)),a.isUserInGroupList=a.isUserInGroupList.bind(Object(K.a)(a)),a}return Object($.a)(t,e),Object(q.a)(t,[{key:"componentDidMount",value:function(){this.props.fetchContactList(this.props.token)}},{key:"chooseUser",value:function(e){this.props.fetchFilteredContactList(this.props.token,e),this.setState({addChatLogin:e})}},{key:"handleAddUserToList",value:function(e){this.setState({groupUserList:[].concat(Object(B.a)(this.state.groupUserList),[e])})}},{key:"handleRemoveUserFromList",value:function(e){this.setState({groupUserList:this.state.groupUserList.filter((function(t){return t.login!==e}))})}},{key:"isUserInGroupList",value:function(e){for(var t=0;t<this.state.groupUserList.length;t++)if(this.state.groupUserList[t].login===e.login)return!0;return!1}},{key:"a11yProps",value:function(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}}},{key:"render",value:function(){return i.a.createElement(yt.a,{open:this.props.open,onClose:this.handleClose,"aria-labelledby":"add-chat-dialog-title","aria-describedby":"add-chat-dialog-description",maxWidth:"sm",fullWidth:!0},i.a.createElement(_t.a,{id:"add-chat-dialog-title"},"Add new chat"),i.a.createElement(St.a,null,i.a.createElement(Bt.a,{value:this.state.currentTab,onChange:this.handleChange,variant:"fullWidth"},i.a.createElement(Qt.a,Object.assign({label:"New chat"},this.a11yProps(0))),i.a.createElement(Qt.a,Object.assign({label:"New group"},this.a11yProps(1)))),i.a.createElement(aa,{value:this.state.currentTab,index:0,error:this.props.error,login:this.state.addChatLogin,userTyping:this.userTyping,usersList:this.props.usersList,chooseUser:this.chooseUser,isFetching:this.props.isFetching}),i.a.createElement(oa,{value:this.state.currentTab,index:1,error:this.props.addGroupError,login:this.state.addGroupLogin,chatTitle:this.state.chatTitle,userTyping:this.userTyping,contactList:this.props.contactList,addUserToList:this.handleAddUserToList,removeUserFromList:this.handleRemoveUserFromList,isFetching:this.props.isFetching,groupUserList:this.state.groupUserList,userInList:this.isUserInGroupList,validation:this.state.addGroupError})),i.a.createElement(Tt.a,null,i.a.createElement(Te.a,{onClick:this.handleAddChat,color:"primary"},"Add"),i.a.createElement(Te.a,{onClick:this.handleClose,color:"primary",autoFocus:!0},"Cancel")))}}]),t}(i.a.Component),ca=Object(me.a)((function(e){return{token:e.auth.token,error:e.chats.addChatError,isAddingChat:e.chats.isAddingChat,usersList:e.contacts.filteredContacts,contactList:e.contacts.contacts,isFetching:e.contacts.isFetching}}),(function(e){return{addChat:function(t,a){return e(un(t,a))},addChatClose:function(){return e(ln())},addGroup:function(t,a,n){return e(bn(t,a,n))},fetchUsersData:function(t,a){return e(Pe(t,a))},cleanUsersData:function(){return e({type:"CLEAN_USERS_DATA"})},fetchContactList:function(t){return e(zt(t))},fetchFilteredContactList:function(t,a){return e(Vt(t,a))},cleanContactList:function(){return e({type:"CLEAN_CONTACT_LIST"})}}}))(Ee()((function(e){return{}}))(ia));var la=Ee()((function(e){return{avatar:{width:100,height:100,fontSize:"2.25rem",border:"2px solid",borderColor:e.palette.primary.main,cursor:"pointer",position:"relative"},userInfo:{display:"flex",alignItems:"center"},info:{paddingLeft:15},chip:{marginTop:5},actions:{"& button":{marginLeft:"0 !important"}}}}))((function(e){for(var t=function(){e.setOpen("user-info",!1)},a=e.classes,n=[],r=0;r<e.contacts.length;r++)n.push(e.contacts[r].login);return i.a.createElement(yt.a,{open:e.open,onClose:t,"aria-labelledby":"user-info-dialog-title","aria-describedby":"user-info-dialog-description"},i.a.createElement(St.a,null,i.a.createElement("div",{className:a.userInfo},e.data.profile_image?i.a.createElement(At.a,{className:a.avatar,src:""+e.data.profile_image}):i.a.createElement(At.a,{className:a.avatar},(e.data.name?e.data.name.charAt(0).toUpperCase():"")+""+(e.data.surname?e.data.surname.charAt(0).toUpperCase():"")),i.a.createElement("div",{className:a.info},i.a.createElement(sa.a,{component:"h5",variant:"h5"},e.data.name+" "+e.data.surname),i.a.createElement(sa.a,{variant:"body1"},"Login: ",e.data.login),n.includes(e.data.login)?i.a.createElement(na.a,{variant:"outlined",color:"primary",size:"small",label:"Your contact",className:a.chip}):null))),i.a.createElement(Tt.a,{className:a.actions},n.includes(e.data.login)?i.a.createElement("div",null,i.a.createElement(Te.a,{onClick:function(){e.handleGoToChat(),t()},color:"primary"},"Go to chat"),i.a.createElement(Te.a,{onClick:e.handleRemoveContact,color:"secondary"},"Delete")):i.a.createElement(Te.a,{onClick:e.handleAddContact,color:"primary"},"Add contact"),i.a.createElement(Te.a,{onClick:t,autoFocus:!0},"Close")))}));var ua=function(e){return i.a.createElement(yt.a,{open:e.open,onClose:function(){return e.setOpen("contact",!1)},"aria-labelledby":"delete-contact-dialog-title","aria-describedby":"delete-contact-dialog-description"},i.a.createElement(_t.a,{id:"delete-contact-dialog-title"},"Delete contact"),i.a.createElement(St.a,null,i.a.createElement(Ut.a,{id:"delete-contact-dialog-description"},"Are you sure you want to delete this contact?")),i.a.createElement(Tt.a,null,i.a.createElement(Te.a,{onClick:e.handleRemoveContact,color:"primary"},"Ok"),i.a.createElement(Te.a,{onClick:function(){return e.setOpen("contact",!1)},color:"primary",autoFocus:!0},"Cancel")))},pa=function(e){function t(e){var a;return Object(Y.a)(this,t),(a=Object(J.a)(this,Object(Z.a)(t).call(this,e))).handleSearch=function(e){return a.setState({searchValue:e.target.value})},a.setOpen=function(e,t){"user-info"===e?a.setState({userInfoOpen:t}):"contact"===e&&a.setState({deleteContactDialogOpen:t})},a.state={searchValue:"",selectedUser:null,userInfoOpen:!1,deleteContactDialogOpen:!1},a.handleSearch=a.handleSearch.bind(Object(K.a)(a)),a}return Object($.a)(t,e),Object(q.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.value,n=t.index,r=this.props.classes;return i.a.createElement("div",{hidden:a!==n,id:"simple-tabpanel-".concat(n),"aria-labelledby":"simple-tab-".concat(n)},a===n&&i.a.createElement("div",null,i.a.createElement(Jt.a,{fullWidth:!0,value:this.state.searchValue,onChange:this.handleSearch,placeholder:"Filter by user name",className:r.search}),this.props.contacts&&this.props.contacts.length>0?i.a.createElement("div",{className:r.list},this.props.contacts.sort((function(e,t){return e.name<t.name?-1:1})).filter((function(t){return(t.name+" "+t.surname).toLowerCase().includes(e.state.searchValue.toLowerCase())})).map((function(t,a){return i.a.createElement(Ke,{key:a,user:t,className:r.user,handleClick:function(){e.setState({selectedUser:t}),e.setOpen("user-info",!0)}})}))):i.a.createElement(Kt.a,null,i.a.createElement(Xt.a,{secondary:"You don't have any contacts."})),this.props.isFetching?i.a.createElement("div",{className:r.progress},i.a.createElement(ta.a,{color:"primary"})):null,this.state.selectedUser?i.a.createElement(la,{open:this.state.userInfoOpen,setOpen:this.setOpen,data:this.state.selectedUser,contacts:this.props.contacts,handleGoToChat:function(){return e.props.handleGoToChat(e.state.selectedUser.login)},handleRemoveContact:function(){return e.setOpen("contact",!0)}}):null,i.a.createElement(ua,{open:this.state.deleteContactDialogOpen,setOpen:this.setOpen,handleRemoveContact:function(){e.props.handleRemoveContact(e.state.selectedUser),e.setOpen("contact",!1)}})))}}]),t}(i.a.Component),da=Ee()((function(e){return{progress:{display:"flex",justifyContent:"center",alignItems:"center",marginTop:"15px"},list:{maxHeight:"216px",overflowY:"auto"},addBtn:{textAlign:"center"},search:{marginTop:"10px",marginBottom:"10px"}}}))(pa),ha=a(253),ga=a.n(ha),ma=a(252),fa=a.n(ma),Ea=a(132),ba=a.n(Ea),va=a(92),Ca=a.n(va),Oa=Object(u.a)((function(e){return{listItem:{position:"relative","&.Mui-selected":{backgroundColor:"rgba(8, 116, 255, 0.2) !important"}},time:{fontSize:"12px",fontFamily:"'Roboto', sans-serif",position:"absolute",right:"16px",top:"14px",color:e.palette.text.secondary},avatar:{borderColor:e.palette.text.disabled},button:{padding:0}}}));function ya(e){var t=e.data.sender,a=Oa();return t?i.a.createElement(ne.a,{className:a.listItem},i.a.createElement(de.a,null,t.profile_image?i.a.createElement(he.a,{src:""+t.profile_image,className:a.avatar}):i.a.createElement(he.a,{className:a.avatar},t.name.charAt(0).toUpperCase()+""+(t.surname?t.surname.charAt(0).toUpperCase():""))),i.a.createElement(se.a,{primary:i.a.createElement("b",null,t.name+" "+(t.surname?t.surname:"")),secondary:i.a.createElement(i.a.Fragment,null,e.data.message)}),i.a.createElement(v.a,{className:a.button,onClick:e.handleAccept},i.a.createElement(ba.a,{color:"primary"})),i.a.createElement(v.a,{className:a.button,onClick:e.handleDecline},i.a.createElement(Ca.a,null))):null}var Ta=Ee()((function(e){return{progress:{display:"flex",justifyContent:"center",alignItems:"center",marginTop:"15px"},list:{maxHeight:"216px",overflowY:"auto"},addBtn:{textAlign:"center"}}}))((function(e){var t=e.value,a=e.index,n=e.classes;return i.a.createElement("div",{hidden:t!==a,id:"simple-tabpanel-".concat(a),"aria-labelledby":"simple-tab-".concat(a)},t===a&&i.a.createElement("div",{className:n.list},e.invitations&&e.invitations.received.length>0?i.a.createElement("div",{className:"users-list"},e.invitations.received.map((function(t,a){return i.a.createElement(ya,{key:a,data:t,handleAccept:function(){return e.acceptInvitation(t.sender.login)},handleDecline:function(){return e.declineInvitation(t.sender.login)}})}))):i.a.createElement(Kt.a,null,i.a.createElement(Xt.a,{secondary:"You don't have any invitations."})),e.isFetching?i.a.createElement("div",{className:n.progress},i.a.createElement(ta.a,{color:"primary"})):null))})),Sa=a(254),Ua=a.n(Sa);var _a=Ee()((function(e){return{progress:{display:"flex",justifyContent:"center",alignItems:"center",marginTop:"15px"},user:{cursor:"pointer"},error:{marginTop:"15px"}}}))((function(e){var t=function(){e.setOpen(!1)},a=e.classes;return i.a.createElement(yt.a,{open:e.open,onClose:t,"aria-labelledby":"add-contact-dialog-title","aria-describedby":"add-contact-dialog-description",maxWidth:"xs",fullWidth:!0},i.a.createElement(_t.a,{id:"add-contact-dialog-title"},"Add contact"),i.a.createElement(St.a,null,i.a.createElement("div",null,e.successMsg?i.a.createElement(Dt.a,{severity:"success",className:a.error},e.successMsg):null,e.error?i.a.createElement(Dt.a,{severity:"error",className:a.error},e.error):null,i.a.createElement(Jt.a,{margin:"dense",id:"add-contact-login-input",label:"Enter user login",fullWidth:!0,value:e.login,onChange:function(t){return e.userTyping(t,"login")},autoComplete:"off"}),e.contactList&&e.login.length>=3?i.a.createElement("div",{className:"users-list"},e.contactList.map((function(t,n){return i.a.createElement(Ke,{key:n,user:t,className:a.user,handleClick:e.chooseUser,selected:e.login===t.login})}))):null,e.contactList&&0===e.contactList.length&&e.login.length>=3?i.a.createElement(Kt.a,null,i.a.createElement(Xt.a,{secondary:"User with this login does not exist or you already have this user in your contact list."})):null,e.isFetching?i.a.createElement("div",{className:a.progress},i.a.createElement(ta.a,{color:"primary"})):null,i.a.createElement(Jt.a,{margin:"dense",id:"add-contact-message-input",label:"Enter message",fullWidth:!0,value:e.message,onChange:function(t){return e.userTyping(t,"message")},autoComplete:"off",maxLength:50}))),i.a.createElement(Tt.a,null,i.a.createElement(Te.a,{onClick:e.handleSendInvitation,color:"primary"},"Send"),i.a.createElement(Te.a,{onClick:t,color:"primary",autoFocus:!0},"Close")))})),ka=a(422);var Ra=function(e){function t(e){var a;return Object(Y.a)(this,t),(a=Object(J.a)(this,Object(Z.a)(t).call(this,e))).userTyping=function(e,t){switch(t){case"login":var n=e.target.value;n.length>=3?a.props.fetchUsersData(a.props.token,n):a.props.cleanUsersData(),a.setState({login:n});break;case"message":var r=e.target.value;r.length<50&&a.setState({inviteMessage:r})}},a.handleSnackbarClose=function(e,t){"clickaway"!==t&&a.setState({snackbar:{type:"",message:"",open:!1}})},a.handleClose=function(){a.props.setOpen("contacts",!1)},a.handleChange=function(e,t){a.setState({currentTab:t})},a.handleAddContactModalOpen=function(e){return a.setState({contactDialogOpen:e,success:"",error:"",login:"",inviteMessage:""})},a.handleGoToChat=function(e){a.props.handleGoToChat(e),a.handleClose()},a.handleRemoveContact=function(e){a.props.handleRemoveContact(e),a.handleClose()},a.state={currentTab:0,contactDialogOpen:!1,login:"",inviteMessage:"",error:"",success:"",snackbar:{type:"",message:"",open:!1}},a.userTyping=a.userTyping.bind(Object(K.a)(a)),a.chooseUser=a.chooseUser.bind(Object(K.a)(a)),a.handleAddContactModalOpen=a.handleAddContactModalOpen.bind(Object(K.a)(a)),a.handleSendInvitation=a.handleSendInvitation.bind(Object(K.a)(a)),a.handleAcceptInvitation=a.handleAcceptInvitation.bind(Object(K.a)(a)),a.handleDeclineInvitation=a.handleDeclineInvitation.bind(Object(K.a)(a)),a.setSocketListeners=a.setSocketListeners.bind(Object(K.a)(a)),a}return Object($.a)(t,e),Object(q.a)(t,[{key:"componentDidMount",value:function(){this.props.fetchContactList(this.props.token),this.props.fetchInvitationList(this.props.token),this.setSocketListeners()}},{key:"setSocketListeners",value:function(){var e=this;this.props.socket.on("invitation_sent",(function(t){e.props.userLogin===t.sender?(e.setState({success:t.message,error:"",login:"",inviteMessage:""}),e.handleAddContactModalOpen(!1),e.handleShowSnackbar("success",t.message)):e.props.userLogin===t.receiver&&e.props.fetchInvitationList(e.props.token)})),this.props.socket.on("invitation_error",(function(t){e.props.userLogin===t.sender&&e.setState({error:t.error,success:""})})),this.props.socket.on("invitation_accepted",(function(t){e.props.fetchContactList(e.props.token),e.props.fetchInvitationList(e.props.token),e.props.userLogin===t.receiver&&e.handleShowSnackbar("success",t.message)})),this.props.socket.on("invitation_declined",(function(t){e.props.userLogin===t.receiver&&(e.props.fetchInvitationList(e.props.token),e.handleShowSnackbar("info",t.message))}))}},{key:"handleSendInvitation",value:function(){var e={sender:this.props.userLogin,receiver:this.state.login,message:this.state.inviteMessage};this.props.socket.emit("send_invitation",e)}},{key:"handleAcceptInvitation",value:function(e){var t={sender:e,receiver:this.props.userLogin};this.props.socket.emit("accept_invitation",t)}},{key:"handleDeclineInvitation",value:function(e){var t={sender:e,receiver:this.props.userLogin};this.props.socket.emit("decline_invitation",t)}},{key:"handleShowSnackbar",value:function(e,t){this.setState({snackbar:{type:e,message:t,open:!0}})}},{key:"chooseUser",value:function(e){this.props.fetchUsersData(this.props.token,e),this.setState({login:e})}},{key:"a11yProps",value:function(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}}},{key:"render",value:function(){var e=this,t=this.props.classes;return i.a.createElement(yt.a,{open:this.props.open,onClose:this.handleClose,"aria-labelledby":"contacts-dialog-title","aria-describedby":"contacts-dialog-description",maxWidth:"sm",fullWidth:!0},i.a.createElement(_t.a,{id:"contacts-dialog-title"},"Contacts",i.a.createElement(fa.a,{className:t.addBtn,onClick:function(){return e.handleAddContactModalOpen(!0)}},i.a.createElement(ga.a,null))),i.a.createElement(St.a,null,i.a.createElement(Bt.a,{value:this.state.currentTab,onChange:this.handleChange,variant:"fullWidth"},i.a.createElement(Qt.a,Object.assign({label:"List"},this.a11yProps(0))),this.props.invitations&&this.props.invitations.received.length>0?i.a.createElement(Qt.a,Object.assign({label:i.a.createElement(Ua.a,{badgeContent:this.props.invitations.received.length,color:"primary",className:t.badge},"Invitations")},this.a11yProps(1))):i.a.createElement(Qt.a,Object.assign({label:"Invitations"},this.a11yProps(1)))),i.a.createElement(da,{value:this.state.currentTab,index:0,contacts:this.props.contacts,handleGoToChat:this.handleGoToChat,handleRemoveContact:this.handleRemoveContact,isFetching:this.props.isFetching}),i.a.createElement(Ta,{value:this.state.currentTab,index:1,invitations:this.props.invitations,isFetching:this.props.isContactsFetching,acceptInvitation:this.handleAcceptInvitation,declineInvitation:this.handleDeclineInvitation}),i.a.createElement(_a,{open:this.state.contactDialogOpen,setOpen:this.handleAddContactModalOpen,userTyping:this.userTyping,login:this.state.login,contactList:this.props.usersList,chooseUser:this.chooseUser,isFetching:this.props.isDataFetching,message:this.state.inviteMessage,error:this.state.error,successMsg:this.state.success,handleSendInvitation:this.handleSendInvitation})),i.a.createElement(Tt.a,null,i.a.createElement(Te.a,{onClick:this.handleClose,color:"primary",autoFocus:!0},"Close")),i.a.createElement(ka.a,{open:this.state.snackbar.open,autoHideDuration:6e3,onClose:this.handleSnackbarClose,anchorOrigin:{vertical:"bottom",horizontal:"left"}},i.a.createElement(Lt.a,{onClose:this.handleSnackbarClose,severity:this.state.snackbar.type},this.state.snackbar.message)))}}]),t}(i.a.Component),Aa=Object(me.a)((function(e){return{token:e.auth.token,contacts:e.contacts.contacts,invitations:e.contacts.invitations,isContactsFetching:e.contacts.isFetching,usersList:e.data.usersList,isDataFetching:e.data.isFetching,userLogin:e.auth.login,chats:e.chats.chats}}),(function(e){return{fetchContactList:function(t){return e(zt(t))},fetchInvitationList:function(t){return e(Yt(t))},fetchUsersData:function(t,a){return e(Pe(t,a))},cleanUsersData:function(){return e({type:"CLEAN_USERS_DATA"})},addChat:function(t,a,n){return e(un(t,a,n))},getChats:function(t){return e(rn(t))}}}))(Ee()((function(e){return{addBtn:{float:"right"},badge:{"& span":{right:"-12px"}}}}))(Ra)),ja=a(255),Da=a.n(ja),La=Object(u.a)((function(e){return{listItem:{position:"relative","&.Mui-selected":{backgroundColor:"rgba(8, 116, 255, 0.2) !important"}},group3:{marginLeft:"-35px","&:first-child":{marginLeft:"-8px"}},title:{fontSize:"18px",marginLeft:"5px",fontWeight:500}}}));function wa(e){var t=e.users,a=La();return t.length>0?i.a.createElement(ne.a,{className:a.listItem},i.a.createElement(ge.a,{max:2},e.groupPhoto?i.a.createElement(he.a,{src:""+e.groupPhoto}):t.slice(0,3).map((function(e,t){return i.a.createElement(he.a,{key:t,src:e.profile_image?""+e.profile_image:null,className:a.group3},e.profile_image?null:e.name.charAt(0).toUpperCase()+""+(e.surname?e.surname.charAt(0).toUpperCase():""))}))),i.a.createElement(se.a,{primary:i.a.createElement("b",{className:a.title},e.chatTitle)}),i.a.createElement(v.a,{color:"primary","aria-label":"info",onClick:e.handleChatInfoOpen},i.a.createElement(Da.a,null))):null}var xa=function(e){return i.a.createElement(yt.a,{open:e.open,onClose:function(){return e.setOpen("chat",!1)},"aria-labelledby":"delete-chat-dialog-title","aria-describedby":"delete-chat-dialog-description"},i.a.createElement(_t.a,{id:"delete-chat-dialog-title"},"Delete chat"),i.a.createElement(St.a,null,i.a.createElement(Ut.a,{id:"delete-chat-dialog-description"},"Are you sure you want to delete this chat?")),i.a.createElement(Tt.a,null,i.a.createElement(Te.a,{onClick:e.handleRemoveChat,color:"primary"},"Ok"),i.a.createElement(Te.a,{onClick:function(){return e.setOpen("chat",!1)},color:"primary",autoFocus:!0},"Cancel")))},Ia=function(e){function t(e){var a;return Object(Y.a)(this,t),(a=Object(J.a)(this,Object(Z.a)(t).call(this,e))).handleSetOpenDialog=function(e,t){switch(e){case"chat":a.setState({deleteChatDialogOpen:t});break;case"contact":a.setState({deleteContactDialogOpen:t})}},a.state={deleteChatDialogOpen:!1,deleteContactDialogOpen:!1},a.handleSetOpenDialog=a.handleSetOpenDialog.bind(Object(K.a)(a)),a}return Object($.a)(t,e),Object(q.a)(t,[{key:"componentDidMount",value:function(){this.props.handleCloseMenu()}},{key:"render",value:function(){var e=this,t=this.props.classes;return i.a.createElement("div",{className:t.chatPreview},1===this.props.getSelectedChatUserList(this.props.chatList).length&&"chat"===this.props.chatList.find((function(t){return t.chat_id===e.props.selectedChat})).type?i.a.createElement("div",{className:t.accountContainer},i.a.createElement(Ke,{user:this.props.getSelectedChatUserList(this.props.chatList)[0]}),i.a.createElement(v.a,{onClick:this.props.handleOpenMenu},i.a.createElement(ot.a,null)),i.a.createElement(it.a,{id:"account-menu",open:Boolean(this.props.anchorMenu),anchorEl:this.props.anchorMenu,onClose:this.props.handleCloseMenu},i.a.createElement(ct.a,{className:t.menuItem,onClick:function(){return e.handleSetOpenDialog("chat",!0)}},"Remove chat"),i.a.createElement(ct.a,{onClick:function(){return e.handleSetOpenDialog("contact",!0)}},"Remove contact"))):i.a.createElement(wa,{users:this.props.getSelectedChatUserList(this.props.chatList),chatTitle:this.props.chatList.filter((function(t){return t.chat_id===e.props.selectedChat}))[0].title,handleChatInfoOpen:this.props.handleChatInfoOpen,groupPhoto:this.props.chatList.find((function(t){return t.chat_id===e.props.selectedChat})).photo}),i.a.createElement(xa,{open:this.state.deleteChatDialogOpen,setOpen:this.handleSetOpenDialog,handleRemoveChat:function(){e.props.handleRemoveChat(),e.handleSetOpenDialog("chat",!1)}}),i.a.createElement(ua,{open:this.state.deleteContactDialogOpen,setOpen:this.handleSetOpenDialog,handleRemoveContact:function(){e.props.handleRemoveContact(),e.handleSetOpenDialog("contact",!1)}}))}}]),t}(i.a.Component),Fa=Ee()((function(e){var t;return{chatPreview:(t={backgroundColor:"white",boxShadow:"0 2px 5px rgba(0, 0, 0, 0.6)",zIndex:10,minHeight:72},Object(p.a)(t,e.breakpoints.down("md"),{minHeight:64}),Object(p.a)(t,"display","flex"),Object(p.a)(t,"alignItems","center"),t),accountContainer:{display:"flex",width:"100%",alignItems:"center"},menu:{"& ul":{padding:0}}}}))(Ia),Na=a(257),Ga=a.n(Na),Ma=a(258),Pa=a.n(Ma),Ha=a(259),Wa=a.n(Ha);var Ba=function(e){return i.a.createElement(yt.a,{open:e.open,onClose:function(){return e.setOpen("delete",!1)},"aria-labelledby":"delete-group-dialog-title","aria-describedby":"delete-group-dialog-description"},i.a.createElement(_t.a,{id:"delete-group-dialog-title"},"Delete group"),i.a.createElement(St.a,null,i.a.createElement(Ut.a,{id:"delte-group-dialog-description"},"Are you sure you want to delete this group?")),i.a.createElement(Tt.a,null,i.a.createElement(Te.a,{onClick:e.handleRemoveGroup,color:"primary"},"Ok"),i.a.createElement(Te.a,{onClick:function(){return e.setOpen("delete",!1)},color:"primary",autoFocus:!0},"Cancel")))},Qa=a(260),za=a.n(Qa);var Va=function(e){return i.a.createElement(yt.a,{open:e.open,maxWidth:"xs",onClose:function(){return e.setOpen("leave",!1)},"aria-labelledby":"leave-group-dialog-title","aria-describedby":"leave-group-dialog-description"},i.a.createElement(_t.a,{id:"leave-group-dialog-title"},"Leave group"),i.a.createElement(St.a,null,i.a.createElement(Ut.a,{id:"leave-group-dialog-description"},"Are you sure you want to leave this group?",e.isOwner?" Someone from group members will be a group owner.":null)),i.a.createElement(Tt.a,null,i.a.createElement(Te.a,{onClick:e.handleLeaveGroup,color:"primary"},"Yes"),i.a.createElement(Te.a,{onClick:function(){return e.setOpen("leave",!1)},color:"primary",autoFocus:!0},"Cancel")))},Ya=a(256),qa=a.n(Ya),Ja=function(e){function t(e){var a;return Object(Y.a)(this,t),(a=Object(J.a)(this,Object(Z.a)(t).call(this,e))).handleClose=function(){a.props.setOpen("manage-members",!1)},a.handleSave=function(){a.props.handleSaveGroupMembers(a.state.users)},a.state={users:[],search:""},a.handleSave=a.handleSave.bind(Object(K.a)(a)),a}return Object($.a)(t,e),Object(q.a)(t,[{key:"componentDidMount",value:function(){this.setState({users:this.props.userList})}},{key:"handleAddUserToList",value:function(e){this.setState({users:[].concat(Object(B.a)(this.state.users),[e])})}},{key:"handleRemoveUserFromList",value:function(e){this.setState({users:this.state.users.filter((function(t){return t.login!==e}))})}},{key:"isUserInGroupList",value:function(e){for(var t=0;t<this.state.users.length;t++)if(this.state.users[t].login===e.login)return!0;return!1}},{key:"render",value:function(){var e=this,t=this.props.classes;return i.a.createElement(yt.a,{open:this.props.open,onClose:this.handleClose,"aria-labelledby":"manage-members-dialog-title","aria-describedby":"manage-members-dialog-description",maxWidth:"xs",fullWidth:!0},i.a.createElement(qa.a,{id:"manage-members-dialog-title"},"Manage group members"),i.a.createElement(St.a,null,i.a.createElement(sa.a,{className:t.label,component:"h6",variant:"h6"},"Members:"),i.a.createElement("div",{className:t.list},this.state.users.map((function(a,n){return i.a.createElement(na.a,{key:n,className:t.chip,color:a.login===e.props.owner?"primary":"default",avatar:a.profile_image?i.a.createElement(At.a,{src:""+a.profile_image}):i.a.createElement(At.a,null,(a.name?a.name.charAt(0).toUpperCase():"")+""+(a.surname?a.surname.charAt(0).toUpperCase():"")),label:a.name+" "+a.surname,variant:"outlined",onDelete:a.login!==e.props.owner&&a.login!==e.props.currentUser?function(){return e.handleRemoveUserFromList(a.login)}:null})}))),i.a.createElement(Jt.a,{margin:"dense",id:"manage-members-input",label:"Filter by user name",fullWidth:!0,value:this.state.search,onChange:function(t){return e.setState({search:t.target.value})},autoComplete:"off"}),this.props.contactList?i.a.createElement("div",{className:t.contactList},this.props.contactList.sort((function(e,t){return e.name<t.name?-1:1})).filter((function(t){return(t.name+" "+t.surname).toLowerCase().includes(e.state.search.toLowerCase())})).filter((function(t){return!e.isUserInGroupList(t)})).map((function(a,n){return i.a.createElement(Ke,{key:n,user:a,className:t.user,handleClick:function(){return e.handleAddUserToList(a)},selected:!1})}))):null,this.props.contactList&&0===this.props.contactList.length?i.a.createElement(Kt.a,null,i.a.createElement(Xt.a,{secondary:"This user does not exist or you already have a chat with this user."})):null),i.a.createElement(Tt.a,{className:t.actions},i.a.createElement(Te.a,{onClick:this.handleSave,color:"primary"},"Save"),i.a.createElement(Te.a,{onClick:this.handleClose,autoFocus:!0},"Close")))}}]),t}(i.a.Component),Za=Ee()((function(e){return{label:{fontSize:"16px",marginTop:"10px"},chip:{marginRight:3,marginBottom:3},list:{display:"flex",flexWrap:"wrap"},contactList:{maxHeight:"216px",overflowY:"auto"}}}))(Ja),Ka=function(e){function t(e){var a;return Object(Y.a)(this,t),(a=Object(J.a)(this,Object(Z.a)(t).call(this,e))).handleSnackbarClose=function(e,t){"clickaway"!==t&&a.setState({snackbar:{type:"",message:"",open:!1}})},a.hanldeToggleEditTitle=function(){return a.setState({title:a.props.selectedChat.title,isEditMode:!a.state.isEditMode})},a.handleRemoveGroup=function(){a.props.handleRemoveGroup(a.props.selectedChat.chat_id),a.setOpen("delete",!1)},a.handleLeaveGroup=function(){var e={chat_id:a.props.selectedChat.chat_id,user:a.props.currentUser};a.props.socket.emit("leave_group",e)},a.setOpen=function(e,t){switch(e){case"delete":a.setState({deleteGroupDialogOpen:t});break;case"leave":a.setState({leaveGroupDialogOpen:t});break;case"photo":a.setState({editPhotoDialogOpen:t});break;case"user-info":a.setState({userInfoOpen:t});break;case"contact":a.setState({deleteContactDialogOpen:t});break;case"manage-members":a.setState({manageMembersDialogOpen:t})}},a.handleUpdatePhoto=function(e){a.props.updateGroupPhoto(a.props.token,e,a.props.selectedChat.chat_id)},a.handleSaveGroupMembers=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].login);a.props.updateGroupMembers(a.props.selectedChat.chat_id,{users:t}),a.setOpen("manage-members",!1)},a.state={isEditMode:!1,title:"",deleteGroupDialogOpen:!1,selectedUser:null,userInfoOpen:!1,deleteContactDialogOpen:!1,leaveGroupDialogOpen:!1,editPhotoDialogOpen:!1,manageMembersDialogOpen:!1,snackbar:{type:"",message:"",open:!1}},a.hanldeToggleEditTitle=a.hanldeToggleEditTitle.bind(Object(K.a)(a)),a.handleUpdateTitle=a.handleUpdateTitle.bind(Object(K.a)(a)),a.handleRemoveGroup=a.handleRemoveGroup.bind(Object(K.a)(a)),a.handleLeaveGroup=a.handleLeaveGroup.bind(Object(K.a)(a)),a.handleShowSnackbar=a.handleShowSnackbar.bind(Object(K.a)(a)),a}return Object($.a)(t,e),Object(q.a)(t,[{key:"componentDidMount",value:function(){this.setSocketListeners()}},{key:"setSocketListeners",value:function(){var e=this;this.props.socket.on("invitation_sent",(function(t){e.props.currentUser===t.sender&&(e.handleShowSnackbar("success",t.message),e.setOpen("user-info",!1))})),this.props.socket.on("invitation_error",(function(t){e.props.currentUser===t.sender&&(e.handleShowSnackbar("error",t.error),e.setOpen("user-info",!1))})),this.props.socket.on("group_left",(function(t){e.props.currentUser===t.user&&(e.handleShowSnackbar("success",t.message),e.setOpen("leave",!1),e.props.selectChat(null)),t.users.includes(e.props.currentUser)&&e.props.getGroups(e.props.token)})),this.props.socket.on("leave_group_error",(function(t){e.props.currentUser===t.user&&(e.handleShowSnackbar("error",t.error),e.setOpen("leave",!1))}))}},{key:"handleShowSnackbar",value:function(e,t){this.setState({snackbar:{type:e,message:t,open:!0}})}},{key:"handleUpdateTitle",value:function(){this.props.updateGroupTitle(this.props.selectedChat.chat_id,this.state.title),this.hanldeToggleEditTitle()}},{key:"handleSendInvitation",value:function(e){var t={sender:this.props.currentUser,receiver:e,message:""};this.props.socket.emit("send_invitation",t)}},{key:"render",value:function(){var e=this,t=this.props.classes;if(this.props.selectedChat){var a=Object(B.a)(this.props.selectedChat.users);return i.a.createElement(Ga.a,{variant:"lg"!==this.props.width?"temporary":"persistent",anchor:"right",open:this.props.open,onClose:function(){return e.props.handleToggle(!1)},className:t.drawer,classes:{paper:t.drawerPaper}},i.a.createElement("div",{className:t.chatInfo},"group"===this.props.selectedChat.type?i.a.createElement("div",{className:t.container},i.a.createElement("div",{className:t.avatarContainer},i.a.createElement(Pa.a,{title:"Click to add new photo"},this.props.selectedChat.photo?i.a.createElement(he.a,{className:t.avatar,src:""+this.props.selectedChat.photo,onClick:function(){return e.setOpen("photo",!0)}}):i.a.createElement(he.a,{className:t.avatar,onClick:function(){return e.setOpen("photo",!0)}},this.props.selectedChat.title.charAt(0).toUpperCase()))),this.state.isEditMode?i.a.createElement("div",{className:t.titleEditField},i.a.createElement(ft.a,{value:this.state.title,onChange:function(t){return e.setState({title:t.target.value})},margin:"dense",id:"group-title-input",label:"Title",fullWidth:!0,autoComplete:"off"}),i.a.createElement(v.a,{onClick:this.handleUpdateTitle,color:"primary",className:t.iconBtn},i.a.createElement(ba.a,null)),i.a.createElement(v.a,{onClick:this.hanldeToggleEditTitle,className:t.iconBtn},i.a.createElement(Ca.a,null))):i.a.createElement(m.a,{variant:"h5",component:"h3",className:t.title},this.props.selectedChat.title,i.a.createElement(v.a,{className:t.editBtn,onClick:this.hanldeToggleEditTitle},i.a.createElement(Wa.a,null))),i.a.createElement(m.a,{variant:"h6",component:"h6",className:t.listLabel},"Members:",i.a.createElement(v.a,{onClick:function(){return e.setOpen("manage-members",!0)},className:t.editBtn},i.a.createElement(le.a,null))),i.a.createElement(te.a,{className:t.userList},a.sort((function(e,t){return e.name<t.name?-1:1})).map((function(t,a){return i.a.createElement(Ke,{key:a,user:t,handleClick:function(){t.login!==e.props.currentUser&&(e.setState({selectedUser:t}),e.setOpen("user-info",!0))},groupOwner:e.props.selectedChat.owner})}))),i.a.createElement(ae.a,null),a.length>1?i.a.createElement(Te.a,{className:t.deleteBtn,onClick:function(){return e.setOpen("leave",!0)}},"Leave Group"):null,this.props.currentUser===this.props.selectedChat.owner?i.a.createElement(Te.a,{className:t.deleteBtn,onClick:function(){return e.setOpen("delete",!0)}},"Delete Group"):null,this.state.selectedUser?i.a.createElement(la,{open:this.state.userInfoOpen,setOpen:this.setOpen,data:this.state.selectedUser,contacts:this.props.contacts,handleGoToChat:function(){return e.props.handleGoToChat(e.state.selectedUser.login)},handleRemoveContact:function(){return e.setOpen("contact",!0)},handleAddContact:function(){return e.handleSendInvitation(e.state.selectedUser.login)}}):null,i.a.createElement(ua,{open:this.state.deleteContactDialogOpen,setOpen:this.setOpen,handleRemoveContact:function(){e.props.handleRemoveContact(e.state.selectedUser),e.setOpen("contact",!1),e.setOpen("user-info",!1)}})):null),i.a.createElement(Ba,{open:this.state.deleteGroupDialogOpen,setOpen:this.setOpen,handleRemoveGroup:this.handleRemoveGroup}),i.a.createElement(Va,{open:this.state.leaveGroupDialogOpen,setOpen:this.setOpen,handleLeaveGroup:this.handleLeaveGroup,isOwner:this.props.currentUser===this.props.selectedChat.owner}),i.a.createElement(Nt,{open:this.state.editPhotoDialogOpen,setOpen:function(t){return e.setOpen("photo",t)},handleUpdatePhoto:this.handleUpdatePhoto}),i.a.createElement(Za,{open:this.state.manageMembersDialogOpen,setOpen:this.setOpen,userList:a,owner:this.props.selectedChat.owner,currentUser:this.props.currentUser,contactList:this.props.contacts,handleSaveGroupMembers:this.handleSaveGroupMembers}),i.a.createElement(za.a,{open:this.state.snackbar.open,autoHideDuration:6e3,onClose:this.handleSnackbarClose,anchorOrigin:{vertical:"bottom",horizontal:"left"}},i.a.createElement(Dt.a,{onClose:this.handleSnackbarClose,severity:this.state.snackbar.type},this.state.snackbar.message)))}return null}}]),t}(i.a.Component),$a=Object(me.a)((function(e){return{currentUser:e.auth.login,contacts:e.contacts.contacts,token:e.auth.token}}),(function(e){return{updateGroupTitle:function(t,a){return e(yn(t,a))},getGroups:function(t){return e(Fn(t))},updateGroupPhoto:function(t,a,n){return e(Pn(t,a,n))},updateGroupMembers:function(t,a){return e(_n(t,a))}}}))(Xe()()(Ee()((function(e){return{drawer:Object(p.a)({width:350},e.breakpoints.down("md"),{width:300}),drawerPaper:Object(p.a)({width:350,marginTop:64},e.breakpoints.down("md"),{marginTop:48,width:300}),drawerHeader:Object(W.a)({display:"flex",alignItems:"center",padding:e.spacing(0,1)},e.mixins.toolbar,{justifyContent:"flex-start",borderBottom:"1px solid",borderBottomColor:e.palette.text.disabled}),chatInfo:{},avatar:{width:150,height:150,fontSize:"3rem",border:"2px solid",borderColor:e.palette.primary.main,cursor:"pointer",position:"relative",backgroundColor:e.palette.secondary},avatarContainer:{display:"flex",justifyContent:"center",padding:"20px 0"},title:{textAlign:"center",margin:"0 auto 20px",position:"relative",paddingLeft:16,paddingRight:16,display:"inline","&:hover button":{display:"block"}},userList:{padding:0,maxHeight:360,overflowY:"auto"},listLabel:{fontWeight:400,paddingLeft:15,position:"relative",paddingRight:16,display:"inline",marginRight:"auto","&:hover button":{display:"block"}},editBtn:{color:e.palette.text.disabled,position:"absolute",right:-10,top:"50%",transform:"translateY(-50%)",padding:0,display:"none","&:hover":{display:"block",backgroundColor:"transparent"}},titleEditField:{display:"flex",alignItems:"center",padding:"0 15px"},iconBtn:{padding:0},container:{display:"flex",flexDirection:"column",justifyContent:"center"},deleteBtn:{color:"red"}}}))(Ka))),Xa=Wt()(""),en=function(e){function t(e){var a;return Object(Y.a)(this,t),(a=Object(J.a)(this,Object(Z.a)(t).call(this,e))).newChatBtnClicked=function(){return a.setModalOpen("add-chat",!0)},a.chatInfoToggle=function(e){return a.setState({chatInfoOpen:e})},a.handleChatInfoToggle=function(){return a.setState({chatInfoOpen:!a.state.chatInfoOpen})},a.handleOpenAccountMenu=function(e){a.setState({anchorMenu:e.currentTarget})},a.handleCloseAccountMenu=function(){a.setState({anchorMenu:null})},a.handleGoToChat=function(e,t){var n=a.props.chats.find((function(t){return t.users.find((function(e){return e.login!==a.props.userLogin})).login===e}));n?(console.log(t),a.selectChat(n.chat_id,t)):a.props.addChat(e,null,a.selectChat)},a.state={selectedChat:null,chatInfoOpen:!1,logOutDialogOpen:!1,accountDialogOpen:!1,addChatDialogOpen:!1,contactsDialogOpen:!1,anchorMenu:null,loadingMessages:[]},a.setModalOpen=a.setModalOpen.bind(Object(K.a)(a)),a.sendMessage=a.sendMessage.bind(Object(K.a)(a)),a.selectChat=a.selectChat.bind(Object(K.a)(a)),a.readMessage=a.readMessage.bind(Object(K.a)(a)),a.removeMessage=a.removeMessage.bind(Object(K.a)(a)),a.getSelectedChatUserList=a.getSelectedChatUserList.bind(Object(K.a)(a)),a.handleRemoveChat=a.handleRemoveChat.bind(Object(K.a)(a)),a.handleRemoveContact=a.handleRemoveContact.bind(Object(K.a)(a)),a}return Object($.a)(t,e),Object(q.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.getChats(this.props.token,null,null,!0),this.props.getGroups(this.props.token,!0),this.props.getUserData(this.props.token),this.setSocketListeners(),window.addEventListener("online",(function(){return e.changeUserStatus("online")})),window.addEventListener("offline",(function(){return e.changeUserStatus("offline")})),window.addEventListener("beforeunload",(function(){e.changeUserStatus("offline")})),window.addEventListener("unload",(function(){e.changeUserStatus("offline")})),this.changeUserStatus("online")}},{key:"componentWillUnmount",value:function(){this.changeUserStatus("offline")}},{key:"setSocketListeners",value:function(){var e=this;Xa.on("message_sent",(function(t){t.users.includes(e.props.userLogin)&&(t.chat===e.state.selectedChat&&t.sender!==e.props.userLogin?e.props.chats.find((function(e){return e.chat_id===t.chat}))?e.readMessage(t.chat).then((function(){e.props.getChats(e.props.token),e.props.getGroups(e.props.token)})):e.readMessage(t.chat,"group").then((function(){e.props.getChats(e.props.token),e.props.getGroups(e.props.token)})):(e.props.getChats(e.props.token),e.props.getGroups(e.props.token)))})),Xa.on("chats_loaded",(function(){e.setState({loadingMessages:[]})})),Xa.on("message_removed",(function(t){t.users.includes(e.props.userLogin)&&(e.props.getChats(e.props.token),e.props.getGroups(e.props.token))})),Xa.on("chat_removed",(function(t){t.users.includes(e.props.userLogin)&&(e.props.getChats(e.props.token),e.state.selectedChat===t.chat&&e.selectChat(null))})),Xa.on("contact_removed",(function(t){t.users.includes(e.props.userLogin)&&(e.props.getChats(e.props.token),e.props.fetchContactList(e.props.token),e.state.selectedChat===t.chat&&e.selectChat(null))})),Xa.on("group_removed",(function(t){t.users.includes(e.props.userLogin)&&(e.props.getGroups(e.props.token),e.state.selectedChat===t.group&&e.selectChat(null))}))}},{key:"changeUserStatus",value:function(e){Xa.emit("change_user_status",{user:this.props.userLogin,status:e})}},{key:"selectChat",value:function(e,t){var a=this,n=t.find((function(t){return t.chat_id===e}));"chat"===n.type?!n.receiverHasRead&&n.messages.length>0&&n.messages[n.messages.length-1].sender.login!==this.props.userLogin?this.readMessage(e,"chat").then((function(){return a.setState({selectedChat:e,chatInfoOpen:!1})})):this.setState({selectedChat:e,chatInfoOpen:!1}):n.receivers.find((function(e){return e.login===a.props.userLogin}))&&n.messages[n.messages.length-1].sender.login!==this.props.userLogin?this.readMessage(e,"group").then((function(){return a.setState({selectedChat:e,chatInfoOpen:!1})})):this.setState({selectedChat:e,chatInfoOpen:!1})}},{key:"readMessage",value:function(){var e=Object(V.a)(z.a.mark((function e(t,a){return z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.readChat(t,a);case 2:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(e,t){var a={type:t,sender:this.props.userLogin,chat:this.state.selectedChat,message:e};this.setState({loadingMessages:[].concat(Object(B.a)(this.state.loadingMessages),[Object(W.a)({},a,{sender:this.props.userData,timestamp:(+new Date).toString(),loading:!0})])}),Xa.emit("send_message",a)}},{key:"removeMessage",value:function(e){var t=this,a=[].concat(Object(B.a)(this.props.groups),Object(B.a)(this.props.chats)).find((function(e){return e.chat_id===t.state.selectedChat}));Xa.emit("remove_message",{message:e,chat:a.chat_id,type:a.type})}},{key:"handleRemoveChat",value:function(){Xa.emit("remove_chat",{chat_id:this.state.selectedChat})}},{key:"handleRemoveContact",value:function(e){var t=this;if(e){var a=this.props.chats.find((function(t){return t.users.find((function(t){return t.login===e.login}))}));console.log(e),console.log(a);var n={};n=a?{chat:a.chat_id,contact:e.login,user:this.props.userLogin}:{chat:null,contact:e.login,user:this.props.userLogin},Xa.emit("remove_contact",n)}else{var r=this.props.chats.find((function(e){return e.chat_id===t.state.selectedChat})).users.find((function(e){return e.login!==t.props.userLogin})).login,s={chat:this.state.selectedChat,contact:r,user:this.props.userLogin};Xa.emit("remove_contact",s)}}},{key:"handleRemoveGroup",value:function(e){Xa.emit("remove_group",{chat_id:e})}},{key:"setModalOpen",value:function(e,t){switch(e){case"logout":this.setState({logOutDialogOpen:t});break;case"account":this.setState({accountDialogOpen:t});break;case"add-chat":this.setState({addChatDialogOpen:t});break;case"contacts":this.setState({contactsDialogOpen:t});break;default:return}}},{key:"getSelectedChatUserList",value:function(e){var t=this,a=e.filter((function(e){return e.chat_id===t.state.selectedChat}))[0];return a?a.users.filter((function(e){return e.login!==t.props.userLogin})):[]}},{key:"render",value:function(){var e=this,t=this.props.classes,a=[];return this.props.chats&&this.props.groups&&(a=[].concat(Object(B.a)(this.props.groups),Object(B.a)(this.props.chats))),i.a.createElement("div",{className:"dashboard "+t.dashboard},i.a.createElement(nt,{history:this.props.history,newChatBtnHandle:this.newChatBtnClicked,selectChatHandle:this.selectChat,selectedChatIndex:this.state.selectedChat,logOutHandleClick:function(){return e.setModalOpen("logout",!0)},accountHandleClick:function(){return e.setModalOpen("account",!0)},contactsHandleClick:function(){return e.setModalOpen("contacts",!0)},chatList:a,user:this.props.userData}),null!==this.state.selectedChat?i.a.createElement("div",{className:this.state.chatInfoOpen?t.contentShift:t.content},i.a.createElement("div",{className:t.chatViewContainer},i.a.createElement(Fa,{getSelectedChatUserList:this.getSelectedChatUserList,chatList:a,selectedChat:this.state.selectedChat,handleChatInfoOpen:this.handleChatInfoToggle,handleOpenMenu:this.handleOpenAccountMenu,handleCloseMenu:this.handleCloseAccountMenu,handleRemoveChat:this.handleRemoveChat,handleRemoveContact:this.handleRemoveContact,anchorMenu:this.state.anchorMenu}),i.a.createElement(dt,{chat:a.filter((function(t){return t.chat_id===e.state.selectedChat}))[0],messages:[].concat(Object(B.a)(a.filter((function(t){return t.chat_id===e.state.selectedChat}))[0].messages),Object(B.a)(this.state.loadingMessages)),handleRemoveMessage:this.removeMessage}),a.find((function(t){return t.chat_id===e.state.selectedChat}))?i.a.createElement(Ot,{selectedChat:this.state.selectedChat,selectedChatType:a.filter((function(t){return t.chat_id===e.state.selectedChat}))[0].type,sendMessageHandle:this.sendMessage}):null)):i.a.createElement("div",{className:t.defaultComponent},i.a.createElement("div",{className:"container"},i.a.createElement(mt.a,{className:t.bigIcon}),i.a.createElement(m.a,{element:"p",className:t.text},"Choose a chat to start conversation."))),i.a.createElement($a,{open:this.state.chatInfoOpen,handleToggle:this.chatInfoToggle,selectedChat:a.filter((function(t){return t.chat_id===e.state.selectedChat}))[0],userLogin:this.props.userLogin,handleSelectChat:this.selectChat,handleRemoveGroup:this.handleRemoveGroup,handleGoToChat:function(t){return e.handleGoToChat(t,a)},handleRemoveContact:this.handleRemoveContact,socket:Xa,selectChat:this.selectChat}),i.a.createElement(kt,{open:this.state.logOutDialogOpen,setOpen:this.setModalOpen}),this.props.userData?i.a.createElement(Pt,{open:this.state.accountDialogOpen,setOpen:this.setModalOpen}):null,i.a.createElement(ca,{open:this.state.addChatDialogOpen,setOpen:this.setModalOpen}),i.a.createElement(Aa,{open:this.state.contactsDialogOpen,setOpen:this.setModalOpen,socket:Xa,handleSelectChat:this.selectChat,handleGoToChat:function(t){return e.handleGoToChat(t,a)},handleRemoveContact:this.handleRemoveContact}))}}]),t}(i.a.Component),tn=Object(me.a)((function(e){return{isFetching:e.chats.isFetching,loaded:e.chats.loaded,chats:e.chats.chats,groups:e.chats.groups,userLogin:e.auth.login,userData:e.data.data,token:e.auth.token}}),(function(e){return{getChats:function(t,a,n,r){return e(rn(t,a,n,r))},readChat:function(t,a){return e(wn(t,a))},fetchContactList:function(t){return e(zt(t))},getGroups:function(t,a){return e(Fn(t,a))},getUserData:function(t){return e(ke(t))},addChat:function(t,a,n){return e(un(t,a,n))}}}))(Ee()(ht)(en));function an(e,t){return Xa.emit("chats_loading"),{type:"RECEIVE_USER_CHATS",payload:{data:e}}}function nn(e){return{type:"FETCH_USER_CHATS_REQUEST",payload:{isFetching:!!e}}}function rn(e,t,a,n){return function(r){r(nn(n)),function(e){return S.a.get("".concat(U,"/chats"),_(e))}(e).then(y).then((function(e){r(an(e)),t&&a&&t(a)})).catch((function(e){401===e.status&&r(I())}))}}function sn(){return{type:"ADD_CHAT_REQUEST"}}function on(){return{type:"ADD_CHAT_SUCCESS",payload:{}}}function cn(e){return{type:"ADD_CHAT_FAILURE",payload:{error:e}}}function ln(){return{type:"ADD_CHAT_CLOSE",payload:{addChatError:null}}}function un(e,t,a){var n=localStorage.getItem("token");return function(r){return r(sn),function(e,t){return S.a.post("".concat(U,"/chats"),{user:t},_(e))}(n,e).then(y).then((function(e){r(on),r(rn(n,a,e.chat_id)),r(Fn(n)),t&&t("add-chat",!1)})).catch((function(e){r(cn(e.response.data.message))}))}}function pn(){return{type:"DELETE_CHAT_REQUEST"}}function dn(e){return{type:"DELETE_CHAT_SUCCESS",payload:{type:"success",message:e}}}function hn(e){return{type:"DELETE_CHAT_FAILURE",payload:{type:"success",message:e}}}function gn(e){var t=localStorage.getItem("token");return function(a){return a({type:"DELETE_CHAT_REQUEST"}),function(e,t){return S.a.delete("".concat(U,"/chat/").concat(t),_(e))}(t,e).then(y).then((function(e){a(dn(e.message)),a(rn(t)),a(Fn(t))})).catch((function(e){a(hn(e.response.data.message))}))}}function mn(){return{type:"ADD_GROUP_REQUEST"}}function fn(){return{type:"ADD_GROUP_SUCCESS"}}function En(e){return{type:"ADD_GROUP_FAILURE",payload:{error:e}}}function bn(e,t,a){var n=localStorage.getItem("token");return function(r){return r(mn),function(e,t,a){return S.a.post("".concat(U,"/groups"),{title:t,users:a},_(e))}(n,e,t).then(y).then((function(e){r(fn),r(rn(n)),r(Fn(n)),a("add-chat",!1)})).catch((function(e){r(En(e.response.data.message))}))}}function vn(){return{type:"UPDATE_GROUP_TITLE_REQUEST"}}function Cn(){return{type:"UPDATE_GROUP_TITLE_SUCCESS"}}function On(e){return{type:"UPDATE_GROUP_TITLE_FAILURE",payload:{error:e}}}function yn(e,t){var a=localStorage.getItem("token");return function(n){return n({type:"UPDATE_GROUP_TITLE_REQUEST"}),function(e,t,a){return S.a.put("".concat(U,"/group/").concat(t),{title:a},_(e))}(a,e,t).then(y).then((function(e){n({type:"UPDATE_GROUP_TITLE_SUCCESS"}),n(rn(a)),n(Fn(a))})).catch((function(e){n(On(e.response.data.message))}))}}function Tn(){return{type:"UPDATE_GROUP_MEMBERS_REQUEST"}}function Sn(){return{type:"UPDATE_GROUP_MEMBERS_SUCCESS"}}function Un(e){return{type:"UPDATE_GROUP_MEMBERS_FAILURE",payload:{error:e}}}function _n(e,t){var a=localStorage.getItem("token");return function(n){return n({type:"UPDATE_GROUP_MEMBERS_REQUEST"}),function(e,t,a){return S.a.post("".concat(U,"/group/").concat(a),t,_(e))}(a,t,e).then(y).then((function(e){n({type:"UPDATE_GROUP_MEMBERS_SUCCESS"}),n(Fn(a))})).catch((function(e){n(Un(e.response.data.message))}))}}function kn(){return{type:"DELETE_GROUP_REQUEST"}}function Rn(e){return{type:"DELETE_GROUP_SUCCESS",payload:{type:"success",message:e}}}function An(e){return{type:"DELETE_GROUP_FAILURE",payload:{type:"success",message:e}}}function jn(e){var t=localStorage.getItem("token");return function(a){return a({type:"DELETE_GROUP_REQUEST"}),function(e,t){return S.a.delete("".concat(U,"/group/").concat(t),_(e))}(t,e).then(y).then((function(e){a(Rn(e.message)),a(rn(t)),a(Fn(t))})).catch((function(e){a(An(e.response.data.message))}))}}function Dn(){return{type:"READ_CHAT_REQUEST",payload:{}}}function Ln(){return{type:"READ_CHAT",payload:{}}}function wn(e,t){var a=localStorage.getItem("token");return function(n){return n(Dn),function(e,t,a){return S.a.put("".concat(U,"/chat/").concat(t),{type:a},_(e))}(a,e,t).then(y).then((function(e){n(Ln),n(rn(a)),n(Fn(a))})).catch((function(e){401===e.status&&n(I())}))}}function xn(e){return Xa.emit("chats_loading"),{type:"RECEIVE_USER_GROUPS",payload:{data:e}}}function In(e){return{type:"FETCH_USER_GROUPS_REQUEST",payload:{isFetching:!!e}}}function Fn(e,t){return function(a){a(In(t)),function(e){return S.a.get("".concat(U,"/groups"),_(e))}(e).then(y).then((function(e){a(xn(e))})).catch((function(e){401===e.status&&a(I())}))}}function Nn(e){return{type:"UPDATE_GROUP_PHOTO",payload:{updatePhotoMessage:e.message}}}function Gn(e){return{type:"UPDATE_GROUP_PHOTO_FAILURE",payload:{updatePhotoMessage:e.message}}}function Mn(){return{type:"UPDATE_GROUP_PHOTO_REQUEST"}}function Pn(e,t,a){return function(n){n({type:"UPDATE_GROUP_PHOTO_REQUEST"}),function(e,t,a){return S.a.put("".concat(U,"/group/image/").concat(a),t,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(e)}})}(e,t,a).then(y).then((function(t){n(Nn(t)),n(Fn(e))})).catch((function(e){403===e.response.status?n(I()):n(Gn(e.response.data))}))}}function Hn(e){return{type:"TOGGLE_SIDEBAR",payload:{sidebarOpen:e}}}function Wn(e){return function(t){t(Hn(e))}}var Bn=Object(u.a)((function(e){return{header:{zIndex:e.zIndex.drawer+1},container:{backgroundColor:e.palette.primary.main},logo:{maxWidth:48,marginRight:10},title:{flexGrow:1},toolbar:Object(p.a)({},e.breakpoints.down("md"),{minHeight:48}),button:Object(p.a)({paddingRight:0},e.breakpoints.up("sm"),{display:"none"}),icon:{color:"white"}}}));var Qn=Object(h.b)((function(e){return{isFetching:e.data.isFetching,isAuthenticating:e.auth.isAuthenticating,isAuthenticated:e.auth.isAuthenticated,isRegistering:e.auth.isRegistering,isChatsFetching:e.chats.isFetching,isAddingChat:e.chats.isAddingChat}}),(function(e){return Object(C.b)(s,e)}))((function(e){var t=Bn();return i.a.createElement(d.a,{position:"fixed",className:t.header},i.a.createElement("div",{className:t.container},i.a.createElement(g.a,{className:t.toolbar},i.a.createElement("img",{src:"/static/logo.png",alt:"EmotionChat",className:t.logo}),i.a.createElement(m.a,{variant:"h6",className:t.title},"EmotionChat"),e.isAuthenticated?i.a.createElement(v.a,{onClick:function(){return e.handleToggleSidebar(!0)},className:t.button},i.a.createElement(b.a,{className:t.icon})):null)),e.isFetching||e.isAuthenticating||e.isRegistering||e.isChatsFetching||e.isAddingChat?i.a.createElement(f.a,{color:"secondary"}):null)})),zn=a(74),Vn=a(104),Yn=function(e){var t;return{registerPage:Object(p.a)({display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},e.breakpoints.down("sm"),{height:"auto",minHeight:"100%",alignItems:"flex-start",flexDirection:"column"}),main:(t={width:"auto",display:"block",marginLeft:e.spacing(3),marginRight:e.spacing(3)},Object(p.a)(t,e.breakpoints.up(500+2*e.spacing(3)),{width:500,marginLeft:"auto",marginRight:"auto"}),Object(p.a)(t,e.breakpoints.down("sm"),{width:"100%",margin:0,flexGrow:1,display:"flex",flexDirection:"column"}),t),paper:Object(p.a)({marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center",padding:"".concat(e.spacing(2),"px ").concat(e.spacing(3),"px ").concat(e.spacing(3),"px")},e.breakpoints.down("sm"),{marginTop:e.spacing(6),borderRadius:0,flexGrow:1,justifyContent:"center"}),form:{width:"100%"},input:{"&:hover:before":{borderBottom:"1px solid rgba(0, 0, 0, 0.42) !important"}},submit:{marginTop:e.spacing(3)},hasAccountHeader:{width:"100%"},logInLink:{width:"100%",textDecoration:"none",color:e.palette.primary.main,fontWeight:"bolder"},alert:{width:"100%",marginTop:"20px"},avatar:{width:"100px",height:"100px",fontSize:"2.25rem",border:"2px solid",borderColor:e.palette.primary.main},progress:{display:"flex",justifyContent:"center",alignItems:"center",margin:"15px 0"},avatarContainer:{marginTop:"20px"},welcomeText:{fontWeight:400}}},qn=a(162),Jn=a(168),Zn=a(160),Kn=a(93),$n=a(428);var Xn=function(e){function t(){var e;Object(Y.a)(this,t),(e=Object(J.a)(this,Object(Z.a)(t).call(this))).userTyping=function(t,a){switch(t){case"login":e.setState({login:a.target.value}),e.props.cleanUserData();break;case"password":e.setState({password:a.target.value})}};return e.state={login:"",password:"",signinError:"",redirectTo:"/login"},e.getData=e.getData.bind(Object(K.a)(e)),e}return Object($.a)(t,e),Object(q.a)(t,[{key:"login",value:function(e){e.preventDefault(),this.props.loginUser(this.state.login,this.state.password),this.props.cleanUserData()}},{key:"getData",value:function(){this.state.login.length>=5&&this.props.getUserData(this.state.login)}},{key:"render",value:function(){var e=this,t=this.props.classes;return i.a.createElement("div",{className:t.registerPage},i.a.createElement("main",{className:t.main},i.a.createElement($n.a,null),i.a.createElement(Kn.a,{className:t.paper},i.a.createElement(m.a,{component:"h1",variant:"h5"},"Sign In"),this.state.signinError||this.props.statusText?i.a.createElement(Lt.a,{severity:"info",className:t.alert},this.state.signinError||this.props.statusText):null,this.props.userData?i.a.createElement("center",{className:t.avatarContainer},this.props.userData.profile_image?i.a.createElement(At.a,{className:t.avatar,src:""+this.props.userData.profile_image}):i.a.createElement(At.a,{className:t.avatar},(this.props.userData.name?this.props.userData.name.charAt(0).toUpperCase():"")+""+(this.props.userData.surname?this.props.userData.surname.charAt(0).toUpperCase():"")),i.a.createElement(m.a,{component:"h2",variant:"h6",className:t.welcomeText},"Welcome, ",this.props.userData.name)):null,i.a.createElement("form",{onSubmit:function(t){return e.login(t)},className:t.form},i.a.createElement(qn.a,{required:!0,fullWidth:!0,margin:"normal"},i.a.createElement(Jn.a,{htmlFor:"signin-email-input"},"Login"),i.a.createElement(Zn.a,{autoFocus:!0,className:t.input,onChange:function(t){return e.userTyping("login",t)},onBlur:this.getData,id:"signin-login-input"})),i.a.createElement(qn.a,{required:!0,fullWidth:!0,margin:"normal"},i.a.createElement(Jn.a,{htmlFor:"signin-password-input"},"Password"),i.a.createElement(Zn.a,{type:"password",className:t.input,onChange:function(t){return e.userTyping("password",t)},id:"signin-password-input"})),i.a.createElement(Te.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:t.submit},"Submit")),i.a.createElement("h5",{className:t.hasAccountHeader},"Don't Have An Account? ",i.a.createElement(Vn.a,{className:t.logInLink,to:"/register"},"Sign Up")))))}}]),t}(i.a.Component),er=Object(h.b)((function(e){return{isAuthenticating:e.auth.isAuthenticating,statusText:e.auth.statusText,userData:e.data.unauthorizedUser}}),(function(e){return{loginUser:function(t,a){return e(N(t,a))},getUserData:function(t){return e(ze(t))},cleanUserData:function(){return e({type:"CLEAN_UNAUTHORIZED_USER_DATA"})}}}))(Ee()(Yn)(Xn)),tr=function(e){var t;return{registerPage:Object(p.a)({display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},e.breakpoints.down("sm"),{height:"auto",minHeight:"100%",alignItems:"flex-start",flexDirection:"column"}),main:(t={width:"auto",display:"block",marginLeft:e.spacing(3),marginRight:e.spacing(3)},Object(p.a)(t,e.breakpoints.up(500+2*e.spacing(3)),{width:500,marginLeft:"auto",marginRight:"auto"}),Object(p.a)(t,e.breakpoints.down("sm"),{width:"100%",margin:0,flexGrow:1,display:"flex",flexDirection:"column"}),t),paper:Object(p.a)({marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center",padding:"".concat(e.spacing(2),"px ").concat(e.spacing(3),"px ").concat(e.spacing(3),"px")},e.breakpoints.down("sm"),{marginTop:e.spacing(6),borderRadius:0,flexGrow:1,justifyContent:"center"}),form:{width:"100%"},input:{"&:hover:before":{borderBottom:"1px solid rgba(0, 0, 0, 0.42) !important"}},submit:{marginTop:e.spacing(3)},hasAccountHeader:{width:"100%"},logInLink:{width:"100%",textDecoration:"none",color:e.palette.primary.main,fontWeight:"bolder"},alert:{width:"100%",marginTop:"20px"}}};var ar=function(e){function t(){var e;return Object(Y.a)(this,t),(e=Object(J.a)(this,Object(Z.a)(t).call(this))).userTyping=function(t,a){switch(t){case"name":e.setState({name:a.target.value});break;case"surname":e.setState({surname:a.target.value});break;case"login":e.setState({login:a.target.value});break;case"password":e.setState({password:a.target.value});break;case"passwordConfirmation":e.setState({passwordConfirmation:a.target.value})}},e.formIsValid=function(){return e.state.password===e.state.passwordConfirmation},e.loginIsValid=function(){return e.state.login.length>=6},e.passwordIsValid=function(){return e.state.password.length>=6},e.submitSignup=function(t){t.preventDefault(),e.setState({signupError:""}),e.loginIsValid()?e.passwordIsValid()?e.formIsValid()?e.props.registerUser(e.state.name,e.state.surname,e.state.login,e.state.password,e.state.redirectTo):e.setState({signupError:"Passwords do not match."}):e.setState({signupError:"Password must be at least 6 characters."}):e.setState({signupError:"Login must be at least 6 characters."})},e.state={name:null,surname:null,login:null,password:null,passwordConfirmation:null,signupError:""},e}return Object($.a)(t,e),Object(q.a)(t,[{key:"render",value:function(){var e=this,t=this.props.classes;return i.a.createElement("div",{className:t.registerPage},i.a.createElement("main",{className:t.main},i.a.createElement($n.a,null),i.a.createElement(Kn.a,{className:t.paper},i.a.createElement(m.a,{component:"h1",variant:"h5"},"Sign Up"),this.state.signupError||this.props.registerStatusText?i.a.createElement(Lt.a,{severity:"info",className:t.alert},this.state.signupError||this.props.registerStatusText):null,i.a.createElement("form",{onSubmit:function(t){return e.submitSignup(t)},className:t.form},i.a.createElement(qn.a,{required:!0,fullWidth:!0,margin:"normal"},i.a.createElement(Jn.a,{htmlFor:"signup-email-input"},"Name"),i.a.createElement(Zn.a,{className:t.input,autoFocus:!0,onChange:function(t){return e.userTyping("name",t)},id:"signup-name-input"})),i.a.createElement(qn.a,{fullWidth:!0,margin:"normal"},i.a.createElement(Jn.a,{htmlFor:"signup-email-input"},"Surname(Optional)"),i.a.createElement(Zn.a,{className:t.input,onChange:function(t){return e.userTyping("surname",t)},id:"signup-surname-input"})),i.a.createElement(qn.a,{required:!0,fullWidth:!0,margin:"normal"},i.a.createElement(Jn.a,{htmlFor:"signup-email-input"},"Login"),i.a.createElement(Zn.a,{className:t.input,onChange:function(t){return e.userTyping("login",t)},id:"signup-login-input"})),i.a.createElement(qn.a,{required:!0,fullWidth:!0,margin:"normal"},i.a.createElement(Jn.a,{htmlFor:"signup-password-input"},"Password"),i.a.createElement(Zn.a,{type:"password",className:t.input,onChange:function(t){return e.userTyping("password",t)},id:"signup-password-input"})),i.a.createElement(qn.a,{required:!0,fullWidth:!0,margin:"normal"},i.a.createElement(Jn.a,{htmlFor:"signup-password-confirmation-input"},"Confirm Password"),i.a.createElement(Zn.a,{type:"password",className:t.input,onChange:function(t){return e.userTyping("passwordConfirmation",t)},id:"signup-password-confirmation-input"})),i.a.createElement(Te.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:t.submit},"Submit")),i.a.createElement("h5",{className:t.hasAccountHeader},"Already Have An Account? ",i.a.createElement(Vn.a,{className:t.logInLink,to:"/login"},"Log In")))))}}]),t}(i.a.Component),nr=Object(h.b)((function(e){return{isRegistering:e.auth.isRegistering,registerStatusText:e.auth.registerStatusText}}),(function(e){return Object(C.b)(n,e)}))(Ee()(tr)(ar)),rr=a(119),sr=a(407),or=Object(rr.a)({palette:{primary:{main:"#0874ff"}},breakpoints:{values:{xs:0,sm:768,md:992,lg:1200}}});function ir(e){return i.a.createElement(sr.a,{theme:or},e.children)}function cr(e){return{token:e.auth.token,userLogin:e.auth.login,isAuthenticated:e.auth.isAuthenticated}}function lr(e){return Object(C.b)(n,e)}function ur(e){var t=function(t){function a(e){var t;return Object(Y.a)(this,a),(t=Object(J.a)(this,Object(Z.a)(a).call(this,e))).state={loaded:!1},t}return Object($.a)(a,t),Object(q.a)(a,[{key:"componentDidMount",value:function(){this.checkAuth()}},{key:"checkAuth",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props;if(t.isAuthenticated)j.push("/");else{var a=localStorage.getItem("token"),n=localStorage.getItem("userLogin");a?k(a).then((function(t){200===t.status?(e.props.loginUserSuccess(a,n),j.push("/")):e.setState({loaded:!0})})):this.setState({loaded:!0})}}},{key:"render",value:function(){return i.a.createElement("div",{className:"auth-component"},!this.props.isAuthenticated&&this.state.loaded?i.a.createElement(e,this.props):null)}}],[{key:"getDerivedStateFromProps",value:function(e,t){if(e.isAuthenticated)j.push("/");else{var a=localStorage.getItem("token"),n=localStorage.getItem("userLogin");if(!a)return{loaded:!0};k(a).then((function(t){if(200!==t.status)return{loaded:!0};e.loginUserSuccess(a,n),j.push("/")})).catch((function(e){localStorage.removeItem("token"),localStorage.removeItem("userLogin"),j.push("/")}))}return null}}]),a}(i.a.Component);return Object(h.b)(cr,lr)(t)}function pr(e){return{token:e.auth.token,userLogin:e.auth.login,isAuthenticated:e.auth.isAuthenticated}}function dr(e){return Object(C.b)(n,e)}function hr(e){var t=function(t){function a(e){var t;return Object(Y.a)(this,a),(t=Object(J.a)(this,Object(Z.a)(a).call(this,e))).state={loaded_if_needed:!1},t}return Object($.a)(a,t),Object(q.a)(a,[{key:"componentDidMount",value:function(){this.checkAuth()}},{key:"checkAuth",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props;if(t.isAuthenticated)this.setState({loaded_if_needed:!0});else{var a=localStorage.getItem("token"),n=localStorage.getItem("userLogin");a?k(a).then((function(t){200===t.status?(e.props.loginUserSuccess(a,n),e.setState({loaded_if_needed:!0})):e.props.history.push("/login")})).catch((function(t){localStorage.removeItem("token"),localStorage.removeItem("userLogin"),e.props.history.push("/login")})):this.props.history.push("/login")}}},{key:"render",value:function(){return i.a.createElement("div",{className:"auth-component"},this.props.isAuthenticated&&this.state.loaded_if_needed?i.a.createElement(e,this.props):null)}}],[{key:"getDerivedStateFromProps",value:function(e,t){if(!e.isAuthenticated){var a=localStorage.getItem("token"),n=localStorage.getItem("userLogin");a?k(a).then((function(t){if(200===t.status)return e.loginUserSuccess(a,n),{loaded_if_needed:!0};e.history.push("/login")})):e.history.push("/login")}return null}}]),a}(i.a.Component);return Object(h.b)(pr,dr)(t)}var gr,mr,fr,Er,br=a(264),vr=a(133),Cr=O({token:null,login:null,isAuthenticated:!1,isAuthenticating:!1,statusText:null,isRegistering:!1,isRegistered:!1,registerStatusText:null},(gr={},Object(p.a)(gr,"LOGIN_USER_REQUEST",(function(e){return Object.assign({},e,{isAuthenticating:!0,statusText:null})})),Object(p.a)(gr,"LOGIN_USER_SUCCESS",(function(e,t){return Object.assign({},e,{isAuthenticating:!1,isAuthenticated:!0,token:t.token,login:t.login,statusText:"You have been successfully logged in."})})),Object(p.a)(gr,"LOGIN_USER_FAILURE",(function(e,t){return Object.assign({},e,{isAuthenticating:!1,isAuthenticated:!1,token:null,userName:null,statusText:"Authentication Error: ".concat(t.status," ").concat(t.statusText)})})),Object(p.a)(gr,"LOGOUT_USER",(function(e){return Object.assign({},e,{isAuthenticated:!1,token:null,userName:null,status:"success",statusText:"You have been successfully logged out."})})),Object(p.a)(gr,"REGISTER_USER_SUCCESS",(function(e,t){return Object.assign({},e,{isAuthenticating:!1,isAuthenticated:!0,isRegistering:!1,token:t.token,login:t.login,registerStatusText:"You have been successfully logged in."})})),Object(p.a)(gr,"REGISTER_USER_REQUEST",(function(e){return Object.assign({},e,{isRegistering:!0})})),Object(p.a)(gr,"REGISTER_USER_FAILURE",(function(e,t){return Object.assign({},e,{isAuthenticated:!1,token:null,login:null,registerStatusText:"Register Error: ".concat(t.status," ").concat(t.statusText)})})),gr)),Or=O({data:null,usersList:null,status:null,isFetching:!1,loaded:!1,unauthorizedUser:null},(mr={},Object(p.a)(mr,"RECEIVE_PROTECTED_DATA",(function(e,t){return Object.assign({},e,{data:t.data,isFetching:!1,loaded:!0})})),Object(p.a)(mr,"FETCH_PROTECTED_DATA_REQUEST",(function(e){return Object.assign({},e,{isFetching:!0})})),Object(p.a)(mr,"UPDATE_USER_DATA",(function(e,t){return Object.assign({},e,{data:t.data,status:t.status,isFetching:!1,loaded:!0})})),Object(p.a)(mr,"UPDATE_USER_DATA_FAILURE",(function(e,t){return Object.assign({},e,{status:t.status,isFetching:!1,loaded:!0})})),Object(p.a)(mr,"UPDATE_USER_DATA_REQUEST",(function(e){return Object.assign({},e,{isFetching:!0})})),Object(p.a)(mr,"UPDATE_USER_DATA_CLOSE",(function(e,t){return Object.assign({},e,{status:t.status})})),Object(p.a)(mr,"UPDATE_USER_PHOTO",(function(e,t){return Object.assign({},e,{data:t.data,status:t.status,isFetching:!1,loaded:!0})})),Object(p.a)(mr,"UPDATE_USER_PHOTO_FAILURE",(function(e,t){return Object.assign({},e,{status:t.status,isFetching:!1,loaded:!0})})),Object(p.a)(mr,"UPDATE_USER_PHOTO_REQUEST",(function(e){return Object.assign({},e,{isFetching:!0})})),Object(p.a)(mr,"FETCH_USERS_DATA_REQUEST",(function(e){return Object.assign({},e,{isFetching:!0})})),Object(p.a)(mr,"RECEIVE_USERS_DATA",(function(e,t){return Object.assign({},e,{usersList:t.users,isFetching:!1})})),Object(p.a)(mr,"CLEAN_USERS_DATA",(function(e){return Object.assign({},e,{usersList:null})})),Object(p.a)(mr,"RECEIVE_UNAUTHORIZED_USER_DATA",(function(e,t){return Object.assign({},e,{unauthorizedUser:t.unauthorizedUser,isFetching:!1})})),Object(p.a)(mr,"FETCH_UNAUTHORIZED_USER_DATA",(function(e){return Object.assign({},e,{isFetching:!0})})),Object(p.a)(mr,"FETCH_UNAUTHORIZED_USER_DATA_FAILURE",(function(e,t){return Object.assign({},e,{status:t.status,isFetching:!1,loaded:!0})})),Object(p.a)(mr,"CLEAN_UNAUTHORIZED_USER_DATA",(function(e){return Object.assign({},e,{unauthorizedUser:null})})),mr)),yr=O({chats:null,groups:null,isFetching:!1,loaded:!1,addChatError:null,isAddingChat:!1,deleteGroupMessage:null,deleteChatMessage:null,sidebarOpen:!1},(fr={},Object(p.a)(fr,"RECEIVE_USER_CHATS",(function(e,t){return Object.assign({},e,{chats:t.data,isFetching:!1,loaded:!0})})),Object(p.a)(fr,"FETCH_USER_CHATS_REQUEST",(function(e,t){return Object.assign({},e,{isFetching:t.isFetching})})),Object(p.a)(fr,"ADD_CHAT_REQUEST",(function(e){return Object.assign({},e,{addChatError:null,isAddingChat:!0})})),Object(p.a)(fr,"ADD_CHAT_SUCCESS",(function(e){return Object.assign({},e,{addChatError:null,isAddingChat:!1})})),Object(p.a)(fr,"ADD_CHAT_FAILURE",(function(e,t){return Object.assign({},e,{addChatError:t.error,isAddingChat:!1})})),Object(p.a)(fr,"ADD_CHAT_CLOSE",(function(e,t){return Object.assign({},e,{addChatError:t.addChatError})})),Object(p.a)(fr,"DELETE_CHAT_REQUEST",(function(e){return Object.assign({},e,{isFetching:!0})})),Object(p.a)(fr,"DELETE_CHAT_SUCCESS",(function(e,t){return Object.assign({},e,{isFetching:!1,deleteChatMessage:t})})),Object(p.a)(fr,"DELETE_CHAT_FAILURE",(function(e,t){return Object.assign({},e,{isFetching:!1,deleteChatMessage:t})})),Object(p.a)(fr,"ADD_GROUP_REQUEST",(function(e){return Object.assign({},e,{addChatError:null,isAddingChat:!0})})),Object(p.a)(fr,"ADD_GROUP_SUCCESS",(function(e){return Object.assign({},e,{addChatError:null,isAddingChat:!1})})),Object(p.a)(fr,"ADD_GROUP_FAILURE",(function(e,t){return Object.assign({},e,{addChatError:t.error,isAddingChat:!1})})),Object(p.a)(fr,"UPDATE_GROUP_TITLE_REQUEST",(function(e){return Object.assign({},e,{isFetching:!0})})),Object(p.a)(fr,"UPDATE_GROUP_TITLE_SUCCESS",(function(e){return Object.assign({},e,{isFetching:!1})})),Object(p.a)(fr,"UPDATE_GROUP_TITLE_FAILURE",(function(e,t){return Object.assign({},e,{updateGroupError:t.error,isFetching:!1})})),Object(p.a)(fr,"UPDATE_GROUP_MEMBERS_REQUEST",(function(e){return Object.assign({},e,{isFetching:!0})})),Object(p.a)(fr,"UPDATE_GROUP_MEMBERS_SUCCESS",(function(e){return Object.assign({},e,{isFetching:!1})})),Object(p.a)(fr,"UPDATE_GROUP_MEMBERS_FAILURE",(function(e,t){return Object.assign({},e,{updateGroupError:t.error,isFetching:!1})})),Object(p.a)(fr,"DELETE_GROUP_REQUEST",(function(e){return Object.assign({},e,{isFetching:!0})})),Object(p.a)(fr,"DELETE_GROUP_SUCCESS",(function(e,t){return Object.assign({},e,{isFetching:!1,deleteGroupMessage:t})})),Object(p.a)(fr,"DELETE_GROUP_FAILURE",(function(e,t){return Object.assign({},e,{isFetching:!1,deleteGroupMessage:t})})),Object(p.a)(fr,"READ_CHAT_REQUEST",(function(e){return Object.assign({},e,{loaded:!1})})),Object(p.a)(fr,"READ_CHAT",(function(e){return Object.assign({},e,{loaded:!0})})),Object(p.a)(fr,"RECEIVE_USER_GROUPS",(function(e,t){return Object.assign({},e,{groups:t.data,isFetching:!1,loaded:!0})})),Object(p.a)(fr,"FETCH_USER_GROUPS_REQUEST",(function(e,t){return Object.assign({},e,{isFetching:t.isFetching})})),Object(p.a)(fr,"UPDATE_GROUP_PHOTO",(function(e,t){return Object.assign({},e,{updatePhotoMessage:t.updatePhotoMessage,isFetching:!1,loaded:!0})})),Object(p.a)(fr,"UPDATE_GROUP_PHOTO_FAILURE",(function(e,t){return Object.assign({},e,{updatePhotoMessage:t.updatePhotoMessage,isFetching:!1,loaded:!0})})),Object(p.a)(fr,"UPDATE_GROUP_PHOTO_REQUEST",(function(e){return Object.assign({},e,{isFetching:!0,loaded:!1})})),Object(p.a)(fr,"TOGGLE_SIDEBAR",(function(e,t){return Object.assign({},e,{sidebarOpen:t.sidebarOpen})})),fr)),Tr=O({filteredContacts:null,contacts:null,isFetching:!1,loaded:!1},(Er={},Object(p.a)(Er,"RECEIVE_CONTACT_LIST",(function(e,t){return Object.assign({},e,{contacts:t.data,isFetching:!1,loaded:!0})})),Object(p.a)(Er,"FETCH_CONTACT_LIST_REQUEST",(function(e){return Object.assign({},e,{isFetching:!0,loaded:!1})})),Object(p.a)(Er,"RECEIVE_FILTERED_CONTACT_LIST",(function(e,t){return Object.assign({},e,{filteredContacts:t.data,isFetching:!1,loaded:!0})})),Object(p.a)(Er,"FETCH_FILTERED_CONTACT_LIST_REQUEST",(function(e){return Object.assign({},e,{isFetching:!0,loaded:!1})})),Object(p.a)(Er,"CLEAN_CONTACT_LIST",(function(e){return Object.assign({},e,{filteredContacts:null})})),Object(p.a)(Er,"RECEIVE_INVITATION_LIST",(function(e,t){return Object.assign({},e,{invitations:t.data,isFetching:!1,loaded:!0})})),Object(p.a)(Er,"FETCH_INVITATION_LIST_REQUEST",(function(e){return Object.assign({},e,{isFetching:!0,loaded:!1})})),Er)),Sr=Object(C.c)({routing:vr.routerReducer,auth:Cr,data:Or,chats:yr,contacts:Tr});var Ur=Object(u.a)((function(){return{app:{height:"100%"}}}));var _r=function(){var e,t=Ur(),a=Object(C.d)(Sr,e,Object(C.a)(br.a)),n=Object(vr.syncHistoryWithStore)(j,a);return i.a.createElement("div",{className:"app "+t.app},i.a.createElement(h.a,{store:a},i.a.createElement(ir,null,i.a.createElement(Qn,null),i.a.createElement(zn.b,{history:n},i.a.createElement(zn.c,null,i.a.createElement(zn.a,{exact:!0,path:"/",component:hr(tn)}),i.a.createElement(zn.a,{path:"/login",component:ur(er)}),i.a.createElement(zn.a,{path:"/register",component:ur(nr)}))))))},kr=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Rr(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}l.a.render(i.a.createElement(_r,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");kr?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Rr(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):Rr(t,e)}))}}()}},[[283,1,2]]]);
//# sourceMappingURL=main.e4d17726.chunk.js.map